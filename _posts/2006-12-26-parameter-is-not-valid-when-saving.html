---
layout: post
title: "Parameter is not valid" when saving a Bitmap with EncoderParameters
tags: [.NET, Graphics, C#]
redirect_from:
  - /blog/2006/12/parameter-is-not-valid-when-saving.html
---
<P>Ran into a weird problem with the following code. When I atempted to save the bitmap I recieved a "<FONT face="Courier New" color=#ff0000>Parameter is not valid</FONT>" error. I snagged this code from a VB.NET app I wrote and translated it, so I knew that it worked. </P>
<P><SPAN style="FONT-SIZE: 11px; COLOR: black; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">Bitmap ChartImage <SPAN style="FONT-SIZE: 11px; COLOR: red; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">=</SPAN> GeneratePieChart(...);<BR><BR>EncoderParameter QualityParam <SPAN style="FONT-SIZE: 11px; COLOR: red; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">=</SPAN> <SPAN style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">new</SPAN> EncoderParameter(System.Drawing.Imaging.Encoder.Quality, 100);<BR>EncoderParameters EncoderParams <SPAN style="FONT-SIZE: 11px; COLOR: red; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">=</SPAN> <SPAN style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">new</SPAN> EncoderParameters();<BR>EncoderParams.Param[0] <SPAN style="FONT-SIZE: 11px; COLOR: red; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">=</SPAN> QualityParam;<BR><BR>MemoryStream ChartStream <SPAN style="FONT-SIZE: 11px; COLOR: red; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">=</SPAN> <SPAN style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">new</SPAN> MemoryStream();<BR><BR>ChartImage.Save(ChartStream, GetEncoderInfo(<SPAN style="FONT-SIZE: 11px; COLOR: #666666; FONT-FAMILY: Courier New; BACKGROUND-COLOR: #e4e4e4">"image/jpeg"</SPAN>), EncoderParams);<BR></SPAN></P>
<P>Rob Gruen ran into the same issue and fortunately blogged about it <A href="http://blogs.msdn.com/robgruen/archive/2004/07/11/179789.aspx">here</A>. Long story short the quality in the EncoderParamater must explicitly passed as a long:</P>
<P><SPAN style="FONT-SIZE: 11px; COLOR: black; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">EncoderParameter QualityParam <SPAN style="FONT-SIZE: 11px; COLOR: red; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">=</SPAN> <SPAN style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">new</SPAN> EncoderParameter(System.Drawing.Imaging.Encoder.Quality, 100<FONT color=#ff0000>L</FONT>);<BR></SPAN></P>