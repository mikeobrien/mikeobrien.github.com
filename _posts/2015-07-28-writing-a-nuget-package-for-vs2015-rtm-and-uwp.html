---
draft: true
layout: post
title: REPOST: Writing a NuGet package for VS2015 RTM and UWP
tags: []
---

<h3>Repost of the post removed from [here](http://blogs.msdn.com/b/lucian/archive/2015/07/27/writing-a-nuget-package-for-vs2015-rtm-and-uwp.aspx).</h3>

<div class="post-content user-defined-markup"><p>There are some changes coming to NuGet in VS2015 RTM, under the name &ldquo;<em>project.json</em>&rdquo;.</p>
<p><strong><em>How should you prepare for this as a NuGet package author? This article explains.</em></strong></p>
<p>&nbsp;</p>
<p>Disclaimer: I'm not on the NuGet team, and this post is my non-authoritative personal opinion.</p>
<p>&nbsp;</p>
<h1>Motivation</h1>
<p>Project.json is a new way for Visual Studio projects to consume NuGet packages. It brings several benefits, which is why NuGet package <em>consumers</em> will like it, and why NuGet package <em>authors</em> will have to support it too:</p>
<ul>
<li>Your .vbproj/.csproj no longer gets polluted with NuGet artefacts. They are kept completely separate.</li>
<li>You can change your app target platform, and change debug/release and x86/x64/arm/anycpu, and NuGet packages will now pick this up immediately &ndash; before you had to uninstall+reinstall them.</li>
<li>You can have two different solutions in two different directories that include the same project (this is particularly useful when you&rsquo;re working across two different repositories)</li>
<li>Your SolutionExplorer&gt;References node looks cleaner because it only includes the packages you&rsquo;ve actually installed, rather than all their dependencies too.</li>
<li>Uninstalling NuGet packages is easier, again because you only have to uninstall the ones you installed rather than all their dependencies.</li>
<li>Packages are cached globally (on a per-user per-machine) basis rather than being downloaded+unzipped into every single solution that uses them.</li>
<li>File&gt;New and InstallNuget both become faster.</li>
<li>You get more precise control over NuGet package upgrades, and version mismatches.</li>
</ul>
<p>The intent of project.json is this: <em>"Installing a NuGet package is nothing more than adding a line to the project.json file; at build-time the libs and .targets from that NuGet package get consumed by msbuild."</em></p>
<p>&nbsp;</p>
<p>Project.json - for now - will be used in the following kinds of projects in VS2015. I expect the list will grow longer as new project types are introduced which will also use project.json:</p>
<ul>
<li><strong>In ASP.NET 5 (&ldquo;DNX&rdquo;) projects</strong></li>
<ul>
<li>Currently still in preview form</li>
</ul>
<li><strong>For Windows 10 Universal app projects (&ldquo;UWP&rdquo;)</strong></li>
<ul>
<li>Requires installation of the <em>VS Universal Windows app development tools</em> that will be released on July 29<sup>th</sup> 2015. To install them (after that date) do &ldquo;Add/Remove Programs &gt; VisualStudio2015 &gt; Modify&rdquo;.</li>
</ul>
<li><strong>For modern Portable Class Library (&ldquo;PCL&rdquo;) development</strong></li>
<ul>
<li>&ldquo;Modern PCLs&rdquo; are ones whose targets are limited to amongst DNX, UWP and .NET46.</li>
<li>Again this requires installation of the VS universal windows tools.</li>
</ul>
<li><strong>For <em>any other project type</em>,</strong></li>
<ul>
<li>You can delete packages.config and add a project.json file manually, to take advantage of its benefits (and unload+reload your project).</li>
<li>This path isn&rsquo;t officially supported, but it mostly works.</li>
<li>Again it requires the VS universal windows tools.</li>
</ul>
</ul>
<p>&nbsp;</p>
<h1>Master table of all the various .NET frameworks</h1>
<p>There have been a lot of different versions of the .NET framework over the years. Key points:</p>
<ul>
<li>It&rsquo;s a mess. Truly it is.</li>
<li>As a NuGet package author you have to be aware of the different versions to write your NuGet packages effectively.</li>
<li>Microsoft has gotten on top of the problem. The mess will be going away within a few years. The solution is something called &ldquo;<span style="color: #0070c0;">dotnet</span>&rdquo;, described below. The <em>project.json</em> approach was introduced in order to support <span style="color: #0070c0;">dotnet</span>.</li>
</ul>
<p>The reason you have to read this section is because the various codes, such as &ldquo;net45&rdquo; and &ldquo;win81&rdquo; and &ldquo;<span style="color: #0070c0;">dotnet</span>&rdquo;, will be an essential part of your NuGet package authoring. You have to understand why they&rsquo;re there, and what they&rsquo;re compatible with.</p>
<p><img src="/blog/images/nuget-changes-matrix.png" alt="" width="627" height="581" /></p>
<p>&nbsp;</p>
<p>Backwards-compatibility works within a row, but there&rsquo;s zero compatibility across different rows. For instance, a library or NuGet package designed for &ldquo;net40&rdquo; will work in &ldquo;net45&rdquo; but might not work (and NuGet will refuse to add a reference) in &ldquo;win81&rdquo;. That&rsquo;s because it might depend on some .NET APIs that are present in net40 but absent in win81. This is all a mess.</p>
<p><strong>Microsoft&rsquo;s solution to this mess is called &ldquo;<span style="color: #0070c0;">dotnet</span>&rdquo;. You won&rsquo;t author NuGet package <em>&ldquo;for a particular platform or set of platforms&rdquo; </em>any longer. Instead you will author your NuGet package for &ldquo;<span style="color: #0070c0;">dotnet</span>&rdquo;, and you will call out which particular APIs your package depends upon. This way your package will install fine <em>on any platform</em>, past present or future, which can offer those APIs.</strong></p>
<p>For instance, if your code uses <em>List&lt;T&gt;</em> internally, then you&rsquo;ll author your NuGet package with a dependency on Microsoft&rsquo;s <em>System.Collections</em> NuGet package since that&rsquo;s where List&lt;T&gt; is implemented. And your package will install fine on every platform that System.Collections can be installed onto. (You can trust that Microsoft will author their System.Collections package with diligence, and will be quick to make sure it&rsquo;s updated for all new platforms...) Let&rsquo;s look at some interesting platforms...</p>
<ul>
<li><strong>.NET46.</strong> This is the framework that&rsquo;s installed as part of the Windows Desktop+Server operating system. If you write an app which targets this, and you add a reference to the System.Collections NuGet package, all it says is &ldquo;<em>nothing to do here since System.Collections is already part of the OS platform which this code will run on</em>&rdquo;.</li>
<li><strong>UAP10.0 (Windows 10 Universal Apps) and DNXCORE50 (ASP.Net 5 Core).</strong> These platforms expect apps to carry their .NET runtime and framework with them, app-locally. If you write an app which targets either of these platforms, and you add a reference to the System.Collections NuGet package, then it copies the actual DLL which implements <em>List&lt;T&gt; </em>right there into your application&rsquo;s &ldquo;bin&rdquo; directory, adjacent to your EXE.</li>
</ul>
<p>Here&rsquo;s a subtle but practically important question... Why is <strong>uap10.0</strong> in the same row as <strong>win81</strong>? In case that question wasn&rsquo;t the first thing that occurred to you, let&rsquo;s walk through why someone would ask it. The win81 platform is guaranteed to provide lots of .NET APIs since they&rsquo;re part of the operating system. And when you do File&gt;New&gt;Universal&gt;Blank to create a new uap10.0 app then it creates a project which includes all those APIs (and more) app-locally via NuGet references. <em>But the app author is at liberty to delete those NuGet references, resulting in something with fewer .NET APIs that win81.</em> So how can the table honestly say that uap10.0 is in the same row and bigger than win81?</p>
<p>Well, uap10.0 is in the same row as win81 simply because that reflects the rules that NuGet uses for judging compatibility. As for the possibility that an app might delete their default NuGet references from their app? You as a NuGet package author must defend against this by specifying <em>dependencies</em> on everything you depend upon.</p>
<p>&nbsp;</p>
<p>It seems likely all of Microsoft&rsquo;s future .NET platforms will operate the same way as UAP10.0 and DNXCORE50: they won&rsquo;t expect the .NET framework to be part of the operating system, they will instead expect it to be delivered app-locally via NuGet packages, and the way to target them will be to author your NuGet packages with &ldquo;<span style="color: #0070c0;">dotnet</span>&rdquo;.</p>
<p>Just how large are we talking? The .NET runtime and framework together add up to ~20mb, which seems a lot. But on platforms that use .NET Native, this strips away everything that you&rsquo;re not using and gets it down to ~5mb. And on platforms that don&rsquo;t, you can probably expect disk-deduplication or other techniques to reduce the footprint to something manageable.</p>
<p>&nbsp;</p>
<p>Color code for the above table:</p>
<table class="MsoTableGrid" style="border: currentColor; border-collapse: collapse;" border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td style="width: 49.25pt; background: #F4B083; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="99">
<p style="margin-bottom: .0001pt; line-height: normal;"><em>&nbsp;</em></p>
</td>
<td style="width: 418.25pt; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="837">
<p style="margin-bottom: .0001pt; line-height: normal;"><em>Red: if possible, don&rsquo;t bother supporting these platforms. When you code for these then your DLL generally references &ldquo;mscorlib&rdquo; (which makes it hard to know which APIs you&rsquo;re using and impossible to use on new platforms). And/or these platforms lack basic functionality such as async/await.<br /> <br /> </em></p>
</td>
</tr>
<tr>
<td style="width: 49.25pt; background: #FFD966; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="99">
<p style="margin-bottom: .0001pt; line-height: normal;"><em>&nbsp;</em></p>
</td>
<td style="width: 418.25pt; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="837">
<p style="margin-bottom: .0001pt; line-height: normal;"><em>Yellow: by all means support them. When you code for these then your DLL references &ldquo;contracts&rdquo; from which you can easily figure out which APIs (i.e. which NuGet packages) your library depends upon. And these platforms provide a decent base level of functionality.<br /> <br /> </em></p>
</td>
</tr>
<tr>
<td style="width: 49.25pt; border: none; border-bottom: double red 4.5pt; background: #A8D08D; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="99">
<p style="margin-bottom: .0001pt; line-height: normal;"><em>&nbsp;</em></p>
</td>
<td style="width: 418.25pt; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="837">
<p style="margin-bottom: .0001pt; line-height: normal;"><em>Green: these platforms are the future. If you write a DLL which targets only green platforms, then it will be built from the ground up with NuGet dependencies.<br /> <br /> </em></p>
</td>
</tr>
<tr>
<td style="width: 49.25pt; border: double red 4.5pt; border-top: none; background: #A8D08D; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="99">
<p style="margin-bottom: .0001pt; line-height: normal;"><em>&nbsp;</em></p>
</td>
<td style="width: 418.25pt; border: none; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="837">
<p style="margin-bottom: .0001pt; line-height: normal;"><em>Green with red border: these platforms don&rsquo;t even assume that .NET is part of the platform. Everything &ndash; the .NET runtime, Microsoft&rsquo;s .NET framework libraries, third-party libraries &ndash;all are referenced as NuGet packages and deployed app-locally.</em></p>
</td>
</tr>
<tr>
<td style="width: 49.25pt; border: none; border-top: double red 4.5pt; padding: 0in 5.4pt 0in 5.4pt; text-align: right;" valign="top" width="99">
<p style="margin-bottom: .0001pt; line-height: normal;"><br />*</p>
</td>
<td style="width: 418.25pt; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="837">
<p style="margin-bottom: .0001pt; line-height: normal;"><br />&ldquo;win&rdquo; and &ldquo;windows&rdquo; can be used interchangeably.<br /> &ldquo;wp&rdquo; and &ldquo;windowsphone&rdquo; can be used interchangeably.<br /> &ldquo;net&rdquo; can be omitted; it is the default</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1>A worked example</h1>
<p>Goal: <em>I wish to write NuGet package which can be used by as many project types as possible. However, I&rsquo;m only going to bother making it work on &gt;=.NET45 project types, i.e. ones where I can use modern features like Async/Await and CallerMemberInfo without fuss. Oh, also, my package uses Json.Net internally.</em></p>
<p>NuGet is hugely expressive. There&rsquo;s a huge number of goals you can achieve, and a huge number of ways to accomplish any one goal. I can&rsquo;t explain everything. So what I&rsquo;ll do is pick just one goal, present my solution, explain my rationale for it, and describe the under-the-hood algorithms that NuGet uses. From that you&rsquo;ll be able to figure out how to accomplish your own goals.</p>
<p>&nbsp;</p>
<h1>Step 1: Create the DLL</h1>
<p>Do File &gt; New &gt; ClassLibrary (Portable) and pick the following targets. This is sometimes known as a &ldquo;Profile 259 PCL&rdquo; [<a href="http://embed.plnkr.co/03ck2dCtnJogBKHJ9EjY/preview">see this webpage for why</a>].</p>
<p><strong><img id="Profile259 PCL targets" src="/blog/images/nuget-changes-pcl-targets.png" alt="" width="379" height="382" border="0" /></strong></p>
<p><em>Rationale:</em> As NuGet package authors we start by thinking about all the platforms that we want our package to be used by. I referred to the Master Table earlier in this document and for each row (i.e. each possible target platform), I picked the oldest version that was still yellow. That gives me the widest reach, without bogging myself down into the difficult-and-niche areas.</p>
<p><span style="color: red;">Exception: I have to <em>unselect</em> the ASP.NET Core 5.0 checkbox, for confusing reasons.</span> This is weird since my DLL will still run fine on ASP.NET 5, thanks to being in a NuGet package with &ldquo;dependencies&rdquo;. I guess the PCL targets dialog isn&rsquo;t yet aware that I&rsquo;m going to provide those dependencies...</p>
<p>Note: the bottom three &ldquo;Xamarin&rdquo; rows appear in the dialog because I&rsquo;ve installed the Xamarin tools into VS. But even if you haven&rsquo;t installed the Xamarin tools, no matter: these three checkboxes are <em>placebos</em>, since the other checkmarks <em>implicitly imply</em> that my PCL will also work on Xamarin.</p>
<p><strong>Portable Class Library</strong>. <em>I want PCLs to be able to consume my NuGet package</em>. The deal is: given that I create my ClassLibrary1.dll with the targets above, then my ClassLibrary1.dll can be consumed by any PCL whose targets are <em>the same or more relaxed</em>. A more relaxed set of targets is where either some rows are unchecked, or they&rsquo;re switched to higher versions. (Thus, to make my library maximally consumable, that&rsquo;s why I checked as many targets as I could, and picked versions as low as possible).</p>
<p>&nbsp;</p>
<p><strong>Testing that my PCL can be consumed by the different project types</strong>. This step isn&rsquo;t strictly necessary but it&rsquo;s useful. And indeed this is how I debug my PCLs.</p>
<p>For all project types that I want to consume my NuPkg, I can actually first try having them reference my PCL directly &ndash; either with a Project-to-Project &ldquo;P2P&rdquo; reference (Reference &gt; AddReference &gt; Solution &gt; ClassLibrary1) or with a raw file reference (References &gt; AddReference &gt; Browse).</p>
<p>There are a few known limitations:</p>
<ul>
<li>You can&rsquo;t P2P reference your Profile259 PCL from a &ldquo;Modern PCL&rdquo; that has ASP.NET Core checked. (A &ldquo;modern PCL&rdquo; is one whose targets are limited to amongst .NET46, Win10, ASP.NET Core). Don&rsquo;t worry about this. You can still do a raw file reference. And once you turn your PCL into a NuGet package then it will work fine. As a workaround, for testing purposes, you can just go to your consuming project&rsquo;s targets and remove ASP.NET Core and then the P2P reference will work.</li>
<li>You can&rsquo;t P2P reference your Profile259 PCL from a &ldquo;DNX&rdquo; project (i.e. ASP.Net 5). And you can&rsquo;t even add a raw file reference because the &ldquo;Browse&rdquo; button doesn&rsquo;t work in DNX projects. Don&rsquo;t worry. Once you turn your PCL into a NuGet package then it will work fine.</li>
</ul>
<p><strong>&nbsp;</strong></p>
<p><strong>Test in .NET Native</strong>. I urge everyone to test their libraries from a Win10 application (&ldquo;UWP&rdquo;) in Release mode. That&rsquo;s especially true if your library uses reflection or serialization in any way.</p>
<p>&ldquo;UWP Release mode&rdquo; is the first .NET platform to use <em>Ahead-Of-Time &ldquo;AOT&rdquo; compilation</em>: it compiles the application and its libraries into native machine code; later, when the app is then deployed and run on customer machines, it no longer even uses the CLR! (As you can imagine, native machine code has a harder time with reflection and serialization than does the CLR). I wouldn&rsquo;t be surprised to see AOT on more .NET platforms in future. That&rsquo;s why I&rsquo;d prefer to validate my library right now while I&rsquo;m first architecting it, rather than having to work around issues after-the-fact.</p>
<p>If your library runs into problems, there&rsquo;s a technique called &ldquo;<a href="http://blogs.msdn.com/b/dotnet/archive/2014/05/24/net-native-deep-dive-optimizing-with-runtime-directives.aspx">rd.xml</a> files&rdquo; by which your library can provide hints to the AOT compiler. If you discover you need these, then the rd.xml file should be deployed in your NuGet package adjacent to the corresponding DLL.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1>Step 2: plan the NuPkg directory structure</h1>
<p>My NuPkg will have the following structure. Note that there are two identical copies of ClassLibrary1.dll in it.</p>
<p style="margin-left: .5in; background: #F2F2F2;"><span style="font-size: 9.0pt; line-height: 107%; font-family: Consolas; color: #0070c0;">WorkedExample.1.0.0.0.nupkg<br /> &nbsp;+-- WorkedExample.nuspec<br /> &nbsp;+-- lib<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+-- dotnet<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;+-- ClassLibrary1.dll<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+-- portable-net45+win8+wpa81+wp8<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+-- ClassLibrary1.dll</span></p>
<p><em>Rationale</em>. This is a bit complicated to explain. I want to start by saying that the &ldquo;<strong>lib\dotnet</strong>&rdquo; subdirectory is the way of the future. That&rsquo;s the direction everyone should head towards. The only reason I have an additional subdirectory in here is so that my NuGet can be consumed by traditional PCLs, which can&rsquo;t consume the &ldquo;lib\dotnet&rdquo; subdirectory. This table shows which of my directories are used by which project types:</p>
<table class="MsoTable15Grid1LightAccent5" style="border: currentColor; border-collapse: collapse;" border="1" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td style="width: 188.75pt; border: solid #B4C6E7 1.0pt; border-bottom: solid #8EAADB 1.5pt; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="378">
<p style="margin-bottom: .0001pt; line-height: normal;"><strong>Directory</strong></p>
</td>
<td style="width: 278.75pt; border-top: solid #B4C6E7 1.0pt; border-left: none; border-bottom: solid #8EAADB 1.5pt; border-right: solid #B4C6E7 1.0pt; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="558">
<p style="margin-bottom: .0001pt; line-height: normal;"><strong>Used by these project types</strong></p>
</td>
</tr>
<tr>
<td style="width: 188.75pt; border: solid #B4C6E7 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="378">
<p style="margin-bottom: .0001pt; line-height: normal;"><em>&lt;no match; fails to install&gt;</em></p>
</td>
<td style="width: 278.75pt; border-top: none; border-left: none; border-bottom: solid #B4C6E7 1.0pt; border-right: solid #B4C6E7 1.0pt; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="558">
<p style="margin-bottom: .0001pt; line-height: normal;">Any platform &lt; .NET45</p>
</td>
</tr>
<tr>
<td style="width: 188.75pt; border: solid #B4C6E7 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="378">
<p style="margin-bottom: .0001pt; line-height: normal;">lib\portable-net45+win8+wpa81+wp8</p>
</td>
<td style="width: 278.75pt; border-top: none; border-left: none; border-bottom: solid #B4C6E7 1.0pt; border-right: solid #B4C6E7 1.0pt; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="558">
<p style="margin-bottom: .0001pt; line-height: normal;">Traditional PCLs.</p>
</td>
</tr>
<tr>
<td style="width: 188.75pt; border: solid #B4C6E7 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="378">
<p style="margin-bottom: .0001pt; line-height: normal;">lib\dotnet</p>
</td>
<td style="width: 278.75pt; border-top: none; border-left: none; border-bottom: solid #B4C6E7 1.0pt; border-right: solid #B4C6E7 1.0pt; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="558">
<p style="margin-bottom: .0001pt; line-height: normal;">Everything else (e.g. UWP apps, .NET Framework apps, Xamarin apps, Modern PCLs)</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p><em>NuGet algorithm</em>. How can you figure out which lib\subdirectories you need? And how can you figure out which project types will use which lib\subdirectory? Here I&rsquo;ll spell out the algorithm that NuGet uses. When you have a project which wants to consume a NuGet package, NuGet will look at your project type, and look at the name of all the lib\subdirectories, and figure out which single subdirectory is the &ldquo;best match&rdquo;. The rules for best-match are complicated, and depend crucially on the Master Table earlier in this article.</p>
<ul>
<li><strong>If your project isn&rsquo;t a portable class library</strong>, then it uses these tie-breakers in order to search for the best match...</li>
<ol>
<li>Look for an &ldquo;exact match platform&rdquo;. For instance, if your project is &ldquo;uap10.0&rdquo; and there is a subdirectory called &ldquo;lib\uap10.0&rdquo; then use it.</li>
<li>Failing that, look for an earlier version of the platform or for the unnumbered code for that platform (i.e. in the Master Table, look in the same row, but further to the left)</li>
<ul>
<li>Example: if the project is .NET45, and there&rsquo;s no &ldquo;lib\net45&rdquo; subdirectory, then look for &ldquo;lib\net40&rdquo;, failing that &ldquo;lib\net35&rdquo; and so on.</li>
<li>Example: if the project is UWP and there&rsquo;s no &ldquo;lib\uap10.0&rdquo; subdirectory, then look for &ldquo;lib\uap&rdquo;, failing that &ldquo;lib\win81&rdquo; or &ldquo;lib\netcore451&rdquo;, and so on.</li>
</ul>
<li><span style="color: red;">Failing that, and if your project is &gt;=45, then look for &ldquo;lib\dotnet&rdquo;</span></li>
<li>Failing that, look for all subdirectories of the form &ldquo;lib\portable-xyz&rdquo; where your project type is amongst those &ldquo;xyz&rdquo; as per rules 1..4. Amongst all of those portable-* candidates, there&rsquo;s a rule for picking the best one, but I don&rsquo;t know it.</li>
<li>Failing that, <span style="color: red;">packages.config used to look just in the root &ldquo;lib\&rdquo; folder, but that functionality is no longer supported in packages.json. If your nupkg used to put DLLs directly in the root &ldquo;lib\&rdquo; folder then it has to change.</span></li>
</ol>
<li><strong>If your project is a PCL,</strong></li>
<ol>
<li><span style="color: red;">If your project is a &ldquo;modern PCL&rdquo; and there exists a subdirectory &ldquo;lib\dotnet&rdquo;, then use it.</span> (A &ldquo;modern PCL&rdquo; is one which targets some or all of .NET46, Win10 and ASP.NetCore, and which targets nothing other than those three.)</li>
<li>Failing that, calculate your project&rsquo;s targets. In the case of a traditional PCL, the targets are those listed in the PCL targets dialog. In the case of a modern PCL, I don&rsquo;t know what the targets are. Then look for a lib subdirectory that is an exact match for your project&rsquo;s targets.</li>
<li>Failing that, look for the best-match &ldquo;lib\portable-*&rdquo; subdirectory. I don&rsquo;t know the rules for &ldquo;best-match&rdquo; in this case.</li>
</ol></ul>
<p>&nbsp;</p>
<p>Attentive readers might spot that I could have got away with just a single subdirectory, called &ldquo;portable-net45+win8+wpa81+wp8+dnxcore50&rdquo;. That&rsquo;s possible, but not best-practice. Best practice is to embrace the &ldquo;<strong>lib\dotnet</strong>&rdquo; folder. The reason is to make it easier on you the package author. It&rsquo;s so that your NuGet package will continue to work when Microsoft or Xamarin or anyone else introduces a new platform that isn&rsquo;t net/win/wpa/wp/dnxcore, but yet still does understand lib\dotnet.</p>
<p>&nbsp;</p>
<h1>Step 3: Craft the .nuspec dependencies</h1>
<p>I create a .nuspec file as follows. This .nuspec file should be part of your project. We will discuss the &lt;dependencies&gt; section, which is hard to follow...</p>
<p style="margin-bottom: .0001pt; line-height: normal; text-autospace: none;"><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&lt;?</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">xml</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">1.0</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">?&gt;</span><br /> <span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">package</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> <span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">metadata</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">SampleNuGetPackage</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">1.0.0.2</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">title</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">Sample NuGet Package</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">title</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">authors</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">Lucian Wischik</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">authors</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">owners</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">Lucian Wischik</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">owners</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">requireLicenseAcceptance</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">false</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">requireLicenseAcceptance</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">description</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">This is a demo portable .NET class library</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">description</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">summary</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">It is referencable by all &gt;=.NET45 clients, including WindowsStore and Phone</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">summary</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependencies</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">targetFramework</span>&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">net</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">Newtonsoft.Json</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">7.0.1</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">targetFramework</span>&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">win</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">Newtonsoft.Json</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">7.0.1</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">targetFramework</span>&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">wp</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">Newtonsoft.Json</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">7.0.1</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">targetFramework</span>&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">wpa</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">Newtonsoft.Json</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">7.0.1</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">targetFramework</span>&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">MonoAndroid</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">Newtonsoft.Json</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">7.0.1</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">targetFramework</span>&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">MonoTouch</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">Newtonsoft.Json</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">7.0.1</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">targetFramework</span>&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">Xamarin.iOS</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">Newtonsoft.Json</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">7.0.1</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">targetFramework</span>&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">portable-net45+win8+wpa81+wp8</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">Newtonsoft.Json</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">7.0.1</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">targetFramework</span>&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">uap</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">Newtonsoft.Json</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">7.0.1</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">System.Runtime</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">4.0.0</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">/&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">System.Resources.ResourceManager</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">4.0.0</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">/&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">System.Collections</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">4.0.0</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">/&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">System.Linq</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">4.0.0</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">/&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">targetFramework</span>&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">dotnet</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">Newtonsoft.Json</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">7.0.1</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">System.Runtime</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">4.0.0</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">/&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">System.Resources.ResourceManager</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">4.0.0</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">/&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">System.Collections</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">4.0.0</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">/&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">System.Linq</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">4.0.0</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">/&gt;</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">group</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;<span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependencies</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> <span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">metadata</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> <span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">package</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span></p>
<p>&nbsp;</p>
<p><em>Goal.</em> My DLL depends on certain other DLLs. I must ensure that when an app references my NuGet package then it also transitively references certain other NuGet packages that contain those other DLLs. The exact set of DLLs that I depend upon varies by platform. I don&rsquo;t want to cause an app to take on more NuGet dependencies than it strictly needs. (This is particularly important for traditional packages.config projects, where each additional NuGet dependency looks ugly in Solution Explorer &gt; References, and is awkward to uninstall via Manage NuGet References).</p>
<p>&nbsp;</p>
<p><strong>First, assemble the full list of dependencies</strong>. I will walk through the process step by step. Let&rsquo;s first take stock of what we know...</p>
<p><strong>Source code</strong>. My library project&rsquo;s source code is listed below. The code is obviously using Json.Net, and Linq, and List&lt;T&gt;, and String.Format.</p>
<p style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal; text-autospace: none;"><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">Public</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">Class</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: #2b91af; background: white;">Class1</span><br /> &nbsp;&nbsp;<span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">Public</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">Shared</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">Function</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;"> f() </span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">As</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">String</span> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">Dim</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;"> s = </span><span style="font-size: 9.0pt; font-family: Consolas; color: #a31515; background: white;">"[""hello"",""world""]"</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">Dim</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;"> x = Newtonsoft.Json.</span><span style="font-size: 9.0pt; font-family: Consolas; color: #2b91af; background: white;">JsonConvert</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">.DeserializeObject(</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">Of</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: #2b91af; background: white;">List</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">(</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">Of</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">String</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">))(s)</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">Return</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: #a31515; background: white;">$"</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">{x.First}</span><span style="font-size: 9.0pt; font-family: Consolas; color: #a31515; background: white;"> I am here"</span><br /> &nbsp;&nbsp;<span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">End</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">Function</span></p>
<p style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal; text-autospace: none;"><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">End</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">Class</span></p>
<p><strong>&nbsp;</strong></p>
<p><strong>Packages.config</strong>. My library project&rsquo;s &ldquo;packages.config&rdquo; file is below. My library obviously depends upon Json.Net.</p>
<p style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal; text-autospace: none;"><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">&lt;?</span><span style="font-size: 9.0pt; font-family: Consolas; color: #a31515; background: white;">xml</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">1.0</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">encoding</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">utf-8</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">?&gt;</span><br /> <span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">&lt;</span><span style="font-size: 9.0pt; font-family: Consolas; color: #a31515; background: white;">packages</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> &nbsp;&nbsp;<span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.0pt; font-family: Consolas; color: #a31515; background: white;">package</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">Newtonsoft.Json</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">7.0.1</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> <span style="font-size: 9.0pt; line-height: 107%; font-family: Consolas; color: blue; background: white;">&lt;/</span><span style="font-size: 9.0pt; line-height: 107%; font-family: Consolas; color: #a31515; background: white;">packages</span><span style="font-size: 9.0pt; line-height: 107%; font-family: Consolas; color: blue; background: white;">&gt;</span></p>
<p><strong>&nbsp;</strong></p>
<p><strong>Assembly manifest</strong>. I built my library, and opened the resulting DLL in the &ldquo;ildasm&rdquo; tool (which comes with Visual Studio 2015). The <em>MANIFEST</em> section looks like this. This provides a list of DLLs which it depends upon.</p>
<p style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal; text-autospace: none;"><span style="font-size: 9.0pt; font-family: Consolas;">.assembly extern System.Runtime {.ver 4:0:0:0 }</span></p>
<p style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal; text-autospace: none;"><span style="font-size: 9.0pt; font-family: Consolas;">.assembly extern System.Resources.ResourceManager { .ver 4:0:0:0 }</span></p>
<p style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal; text-autospace: none;"><span style="font-size: 9.0pt; font-family: Consolas;">.assembly extern System.Collections { .ver 4:0:0:0 }</span></p>
<p style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal; text-autospace: none;"><span style="font-size: 9.0pt; font-family: Consolas;">.assembly extern Newtonsoft.Json { .ver 7:0:0:0 }</span></p>
<p style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal; text-autospace: none;"><span style="font-size: 9.0pt; font-family: Consolas;">.assembly extern System.Linq { .ver 4:0:0:0 }</span></p>
<p>&nbsp;</p>
<p>From this I can produce the list of NuGet packages that my library depends upon:</p>
<ol>
<li><em>Newtonsoft.Json version 7.0.1</em></li>
<ul>
<li>This comes straight from my library project&rsquo;s &ldquo;packages.config&rdquo;</li>
<li>Note that 7.0.1 is the version of the Newtonsoft.Json NuGet package which I depend upon and I read this version number from packages.config; I did not use 7.0.0 which is the assembly version of Newtonsoft.Json.dll contained within that NuGet package.</li>
<li>It&rsquo;s good to write the exact NuGet package version number you depend upon (rather than just writing an earlier number like 7.0.0). This way, NuGet package restore can avoid an extra search.</li>
</ul>
<li><em>System.Runtime version 4.0.0<br /> System.Resources.ResourceManager version 4.0.0<br /> System.Collections version 4.0.0<br /> System.Linq version 4.0.0</em></li>
<ul>
<li>For the .NET framework, Microsoft adopted a simple 1:1 mapping between DLL names, and the NuGet packages that contain them.</li>
<li>(This 1:1 mapping only works because the PCL targets none of the <em>red</em> platforms in the Master Table. Those red platforms simply use <em>mscorlib</em> as a reference, which wouldn&rsquo;t provide any clues as to which NuGet packages are needed).</li>
<li>I had no idea which NuGet package versions to use. So I just did File&gt;New&gt;UWP as a throwaway example of a modern platform, built it, then opened the &ldquo;project.lock.json&rdquo; file. From this I was able to find some typical NuGet package version numbers for each of these NuGet packages.</li>
</ul>
</ol>
<p>&nbsp;</p>
<p><strong>Second, craft platform-specific .nuspec dependencies</strong></p>
<p>Now that I have this full list of NuGet package dependencies, I could simply write it into the .nuspec file as below.<br /> <span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependencies</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> <span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">Newtonsoft.Json</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">7.0.1</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> <span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">System.Runtime</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">4.0.0</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">/&gt;</span><br /> <span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">System.Resources.ResourceManager</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">4.0.0</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">/&gt;</span><br /> <span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">System.Collections</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">4.0.0</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">/&gt;</span><br /> <span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependency</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">id</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">System.Linq</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.5pt; font-family: Consolas; color: red; background: white;">version</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">4.0.0</span><span style="font-size: 9.5pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">/&gt;</span><br /> <span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;"> &lt;/</span><span style="font-size: 9.5pt; font-family: Consolas; color: #a31515; background: white;">dependencies</span><span style="font-size: 9.5pt; font-family: Consolas; color: blue; background: white;">&gt;</span></p>
<p>&nbsp;</p>
<p>This approach would certainly <em>work</em>. But I think it&rsquo;s inelegant because <em>anyone who references my NuGet package</em> from one of the traditional platforms like .NET45 will get those additional NuGet references. They don&rsquo;t even need them.</p>
<p><img id="needless references" src="/blog/images/nuget-changes-needless-references.png" alt="" width="364" height="401" border="0" /></p>
<p>&nbsp;</p>
<p><em>NuGet algorithm</em>. The way I solved this problem was through use of <em>nuspec dependency groups</em>. The .nuspec &lt;dependency&gt; section can have either a flat list of dependencies (as above) or a list of groups of dependencies (as at the start of this section), each one tagged with a &ldquo;targetFramework&rdquo;.</p>
<p>In the case where the .nuspec &lt;dependency&gt; section has a list of groups, then it picks a single best-match group for the current project. It does this using exactly the same algorithm as it used to pick a single best-match <em>lib\subdirectory </em>for the current project.</p>
<p>If you consult the Master Table, and work it through with the NuGet algorithm for picking best match, then here&rsquo;s how my selection of dependency groups will be used by different project types:</p>
<table class="MsoTable15Grid1LightAccent5" style="border: currentColor; border-collapse: collapse;" border="1" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td style="width: 188.75pt; border: solid #B4C6E7 1.0pt; border-bottom: solid #8EAADB 1.5pt; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="378">
<p style="margin-bottom: .0001pt; line-height: normal;"><strong>Dependency group targetFramework</strong></p>
</td>
<td style="width: 278.75pt; border-top: solid #B4C6E7 1.0pt; border-left: none; border-bottom: solid #8EAADB 1.5pt; border-right: solid #B4C6E7 1.0pt; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="558">
<p style="margin-bottom: .0001pt; line-height: normal;"><strong>Used by these project types</strong></p>
</td>
</tr>
<tr>
<td style="width: 188.75pt; border: solid #B4C6E7 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="378">
<p style="margin-bottom: .0001pt; line-height: normal;">net</p>
</td>
<td style="width: 278.75pt; border-top: none; border-left: none; border-bottom: solid #B4C6E7 1.0pt; border-right: solid #B4C6E7 1.0pt; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="558">
<p style="margin-bottom: .0001pt; line-height: normal;">net45, net451, net452, net46</p>
</td>
</tr>
<tr>
<td style="width: 188.75pt; border: solid #B4C6E7 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="378">
<p style="margin-bottom: .0001pt; line-height: normal;">win</p>
</td>
<td style="width: 278.75pt; border-top: none; border-left: none; border-bottom: solid #B4C6E7 1.0pt; border-right: solid #B4C6E7 1.0pt; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="558">
<p style="margin-bottom: .0001pt; line-height: normal;">win8, win81,</p>
</td>
</tr>
<tr>
<td style="width: 188.75pt; border: solid #B4C6E7 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="378">
<p style="margin-bottom: .0001pt; line-height: normal;">wp</p>
</td>
<td style="width: 278.75pt; border-top: none; border-left: none; border-bottom: solid #B4C6E7 1.0pt; border-right: solid #B4C6E7 1.0pt; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="558">
<p style="margin-bottom: .0001pt; line-height: normal;">wp8, wp81</p>
</td>
</tr>
<tr>
<td style="width: 188.75pt; border: solid #B4C6E7 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="378">
<p style="margin-bottom: .0001pt; line-height: normal;">wpa</p>
</td>
<td style="width: 278.75pt; border-top: none; border-left: none; border-bottom: solid #B4C6E7 1.0pt; border-right: solid #B4C6E7 1.0pt; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="558">
<p style="margin-bottom: .0001pt; line-height: normal;">wpa81</p>
</td>
</tr>
<tr>
<td style="width: 188.75pt; border: solid #B4C6E7 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="378">
<p style="margin-bottom: .0001pt; line-height: normal;">MonoAndroid<br /> MonoTouch<br /> Xamarin.iOS</p>
</td>
<td style="width: 278.75pt; border-top: none; border-left: none; border-bottom: solid #B4C6E7 1.0pt; border-right: solid #B4C6E7 1.0pt; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="558">
<p style="margin-bottom: .0001pt; line-height: normal;">MonoAndroid10</p>
<p style="margin-bottom: .0001pt; line-height: normal;">MonoTouch10<br /> Xamarin.iOS10</p>
</td>
</tr>
<tr>
<td style="width: 188.75pt; border: solid #B4C6E7 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="378">
<p style="margin-bottom: .0001pt; line-height: normal;">uap</p>
</td>
<td style="width: 278.75pt; border-top: none; border-left: none; border-bottom: solid #B4C6E7 1.0pt; border-right: solid #B4C6E7 1.0pt; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="558">
<p style="margin-bottom: .0001pt; line-height: normal;">uap10.0</p>
</td>
</tr>
<tr>
<td style="width: 188.75pt; border: solid #B4C6E7 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="378">
<p style="margin-bottom: .0001pt; line-height: normal;">dotnet</p>
</td>
<td style="width: 278.75pt; border-top: none; border-left: none; border-bottom: solid #B4C6E7 1.0pt; border-right: solid #B4C6E7 1.0pt; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="558">
<p style="margin-bottom: .0001pt; line-height: normal;">dnxcore, modern PCLs</p>
</td>
</tr>
<tr>
<td style="width: 188.75pt; border: solid #B4C6E7 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="378">
<p style="margin-bottom: .0001pt; line-height: normal;">portable-net45+win8+wpa81+wp8</p>
</td>
<td style="width: 278.75pt; border-top: none; border-left: none; border-bottom: solid #B4C6E7 1.0pt; border-right: solid #B4C6E7 1.0pt; padding: 0in 5.4pt 0in 5.4pt;" valign="top" width="558">
<p style="margin-bottom: .0001pt; line-height: normal;">traditional PCLs</p>
</td>
</tr>
</tbody>
</table>
<p><em>&nbsp;</em></p>
<p><em>Rationale</em>. For the modern project types with a red border around them (uap10 and dnxcore50), plus for any conjectured future project types (likely based on <span style="color: #0070c0;">dotnet</span> and deploying the framework app-locally), then I need to spell out all of the dependencies including the framework ones:</p>
<ul>
<li><strong>[Full dependencies] </strong>Newtonsoft.Json, System.Runtime, System.Resources.ResourceManager, System.Collections, System.Linq</li>
</ul>
<p>But for all other project types, I can safely assume that the framework dependencies are already satisfied by the platform/OS, so all I want to do is spell out the extra ones:</p>
<ul>
<li><strong>[Brief dependencies]</strong> Newtonsoft.Json</li>
<li>(Pedantically, you were supposed to add &lt;frameworkAssembly&gt; directives to your .nuspec just in case the user had manually deleted important framework references from their References node. But no one ever used these directives correctly, and it wasn&rsquo;t worth doing.)</li>
</ul>
<p>The only way I could figure out how to do this, going by the Master Table and the NuGet best-match algorithm, was to spell out every single traditional dependency group and also spell out uap10.0 explicitly. What a pain. I wish there were an easier way. In a nutshell, the reason it&rsquo;s so hard is (1) I need to specify full dependencies for <span style="color: #0070c0;">dotnet</span>; (2) <span style="color: #0070c0;">dotnet</span> matches every traditional platform, but the traditional platforms should only have brief dependencies, so each one must be explicitly exempted; (3) uap10.0 the traditional &ldquo;win&rdquo; platform, but needs full dependencies, so it has to be exempted once again.</p>
<p>(If anyone can see an easier way to achieve this, please let me know!)</p>
<p>&nbsp;</p>
<p><strong>The lazy approach</strong></p>
<p>Honestly, the work to craft a proper .nuspec &lt;dependencies&gt; section is awful. Let&rsquo;s consider some &ldquo;lazy&rdquo; alternatives. Sorry to say, I don&rsquo;t think any of them deliver a satisfactory experience for the consumer of your NuGet package...</p>
<ul>
<li><em>I might omit the &lt;dependencies&gt; section entirely.</em> But then if my NuGet package is referenced by a project which doesn&rsquo;t also reference Newtonsoft.Json, then it will fail at runtime with a DllLoadException.</li>
<li><em>I might merely put into &lt;dependencies&gt; the items in my library project&rsquo;s packages.config, </em>in this case Newtonsoft.Json. This will run fine on all traditional platforms. It will likely run fine on uap10.0 unless the app author has gone out of their way to delete the default NuGet references, or unless Microsoft in future decides to trim down the set of default NuGet references for a faster leaner system. It will likely fail on dnxcore50, since those projects have just a tiny set of default NuGet references. It will likely fail on future platforms, since they&rsquo;re most likely to follow the lead of dnxcore50.</li>
<li><em>I might merely put into the &lt;dependencies&gt; those items in my library project&rsquo;s packages.config, plus the single catch-all &ldquo;Microsoft.NETCore&rdquo;</em>. The Microsoft.NETCore package represents all of the default NuGet references. This approach will run fine on uap10. It will run fine on dnxcore50 and on future platforms, but it will bloat them due to including &ldquo;the whole world and the kitchen sink&rdquo; while they aim to be lean. It will work on traditional platforms, but will look really terrible since 100+ NuGet references will be added to them.</li>
<li><em>I might abandon the complicated &ldquo;dependency groups&rdquo;, and merely use a flat list of dependencies</em>. As discussed above, this will work on all platforms. On traditional platforms, however, it adds superfluous NuGet references to traditional platforms &ndash; in this case just 4 superfluous references plus their transitive dependencies<span class="msoIns"><ins cite="mailto:Lucian%20Wischik" datetime="2015-07-24T12:38">,</ins></span> but in more realistic libraries it might add 50 or more.</li>
</ul>
<p>&nbsp;</p>
<h1>Step 4: produce the .nupkg file as part of your build</h1>
<p>It&rsquo;s best to make the .nupkg be automatically generated as part of my PCL project&rsquo;s build. This section shows how.</p>
<p>First, from my PCL project, I add a NuGet reference to the &ldquo;NuGet.CommandLine&rdquo; package.</p>
<p>Second, I unload my project, edit the .vbproj/.csproj, and add these lines near the end:<br /> <span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.0pt; font-family: Consolas; color: #a31515; background: white;">Target</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">Name</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">AfterBuild</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">&gt;</span><br /> <span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.0pt; font-family: Consolas; color: #a31515; background: white;">Copy</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">SkipUnchangedFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">true</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">SourceFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">bin\$(Configuration)\ClassLibrary1.dll</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">DestinationFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">bin\$(Configuration)\nupkg\lib\dotnet\ClassLibrary1.dll</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> <span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.0pt; font-family: Consolas; color: #a31515; background: white;">Copy</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">SkipUnchangedFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">true</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">SourceFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">bin\$(Configuration)\ClassLibrary1.xml</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">DestinationFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">bin\$(Configuration)\nupkg\lib\dotnet\ClassLibrary1.xml</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> <span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.0pt; font-family: Consolas; color: #a31515; background: white;">Copy</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">SkipUnchangedFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">true</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">SourceFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">bin\$(Configuration)\ClassLibrary1.pdb</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">DestinationFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">bin\$(Configuration)\nupkg\lib\dotnet\ClassLibrary1.pdb</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> <span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.0pt; font-family: Consolas; color: #a31515; background: white;">Copy</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">SkipUnchangedFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">true</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">SourceFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">bin\$(Configuration)\ClassLibrary1.dll</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">DestinationFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">bin\$(Configuration)\nupkg\lib\portable-net45+win8+wpa81+wp8\ClassLibrary1.dll</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> <span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.0pt; font-family: Consolas; color: #a31515; background: white;">Copy</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">SkipUnchangedFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">true</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">SourceFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">bin\$(Configuration)\ClassLibrary1.xml</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">DestinationFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">bin\$(Configuration)\nupkg\lib\portable-net45+win8+wpa81+wp8\ClassLibrary1.xml</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> <span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.0pt; font-family: Consolas; color: #a31515; background: white;">Copy</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">SkipUnchangedFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">true</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">SourceFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">bin\$(Configuration)\ClassLibrary1.pdb</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">DestinationFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">bin\$(Configuration)\nupkg\lib\portable-net45+win8+wpa81+wp8\ClassLibrary1.pdb</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> <span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.0pt; font-family: Consolas; color: #a31515; background: white;">Copy</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">SkipUnchangedFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">true</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">SourceFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">SampleNugetPackage.nuspec</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">DestinationFiles</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">bin\$(Configuration)\nupkg\SampleNugetPackage.nuspec</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> <span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> &lt;</span><span style="font-size: 9.0pt; font-family: Consolas; color: #a31515; background: white;">Exec</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">Command</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">..\..\..\..\packages\NuGet.CommandLine.2.8.6\tools\NuGet.exe pack SampleNugetPackage.nuspec -OutputDirectory ..</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">WorkingDirectory</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">bin\$(Configuration)\nupkg</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 9.0pt; font-family: Consolas; color: red; background: white;">Outputs</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">=</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">bin\$(Configuration)\*.nupkg</span><span style="font-size: 9.0pt; font-family: Consolas; color: black; background: white;">"</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> /&gt;</span><br /> <span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;"> &lt;/</span><span style="font-size: 9.0pt; font-family: Consolas; color: #a31515; background: white;">Target</span><span style="font-size: 9.0pt; font-family: Consolas; color: blue; background: white;">&gt;</span></p>
<p>&nbsp;</p>
<p><em>Rationale</em>. After the project has been built, these msbuild steps create a &ldquo;bin\Debug\nupkg&rdquo; directory which contains the .nuspec and contains the &ldquo;lib\&rdquo; directory structure we discussed earlier. Then it runs the &ldquo;nuget.exe&rdquo; command-line tool to turn it into a .nupkg and sticks it into your bin\Debug directory. Or Release directory, if you&rsquo;re building in Release mode.</p>
<p>I&rsquo;m not a great expert on msbuild. These msbuild steps have a few shortcomings, which I&rsquo;m sure an msbuild expert can point out <span style="font-family: Wingdings;">J</span> But they&rsquo;re the best I&rsquo;ve got.</p>
<p>The easiest way to test your .nupkg is Tools &gt; Options &gt; NuGet &gt; PackageSources, and add a new source which points straight to your project&rsquo;s bin\debug directory. Then you can easily add a NuGet reference to it from any other app.</p>
<p>&nbsp;</p>
<h1>Special Circumstances</h1>
<p>There are a number of advanced NuGet features. Some of them no longer work with project.json. I&rsquo;ve colored this back-compat breaks in red.</p>
<p><strong><span style="color: red;">&ldquo;Content&rdquo; no longer supported by project.json. </span></strong>A few NuGet packages use &ldquo;content&rdquo;. These are files such as .cs or .png which, in traditional packages.config, got added as source files to your project when you install a NuGet package. You were even able to modify these files once they&rsquo;ve been added. (I never figured out what happens if you subsequently upgrade the package &ndash; does it delete your modifications?) Anyway, content files are no longer supported by project.json and are simply ignored. You must either rewrite your package to avoid it, or <a href="https://github.com/NuGet/Home/issues/627">join in the discussion</a> with the NuGet team about how content should work.</p>
<p><strong><span style="color: red;">&ldquo;Lib\files&rdquo; no longer supported by project.json. </span></strong>It used to be you could include files directly in the root of the lib\ directory, and if no appropriate lib\subdirectory was found, then NuGet would pick files straight from the root. This is no longer supported by project.json and such files are simply ignored. You should consult the Master Table to figure out which lib\subdirectory (or subdirectories) are more appropriate now.</p>
<p><strong><span style="color: red;">&ldquo;Build\files&rdquo; no longer supported by project.json. </span></strong>Likewise it used to be you could include files directly in the root of the build\ directory. This is not currently supported by project.json. You must either rewrite your package to avoid it, again by consulting the Master Table, or follow the NuGet team&rsquo;s progress on fixing <a href="https://github.com/NuGet/Home/issues/965">this bug</a>.</p>
<p><strong><span style="color: red;">&ldquo;install.ps1&rdquo; no longer supported by project.json. </span></strong>It used to be you could have an arbitrary powershell script be invoked when the package is added or removed. This no longer makes sense in the world where NuGet packages are resolved by msbuild, and so install.ps1 and uninstall.ps1 are now simply ignored. You must figure out alternatives. A really powerful alternative is .targets files in a build\subdirectory.</p>
<p><strong><span style="color: red;">Analyzers have changed since VS2015 RC</span></strong>. An &ldquo;Analyzer&rdquo; is a mechanism by which a NuGet package can provide additional warning messages, error messages and quick-fixes inside the VS2015 code editor for VB/C#. You get started with an analyzer by installing the <a href="https://visualstudiogallery.msdn.microsoft.com/2ddb7240-5249-4c8c-969e-5d05823bcb89?SRC=VSIDE">.NET Compiler Platform SDK</a> and doing File&gt;New&gt;Extensibility&gt;Analyzer. How do Analyzer NuGet packages install? In packages.config projects, they install via &ldquo;install1.ps&rdquo;. In project.json projects, they install by convention that they&rsquo;re inside an &ldquo;analyzers\dotnet&rdquo; directory (or &ldquo;analyzers\dotnet\vb&rdquo; or &ldquo;analyzers\dotnet\cs&rdquo; if the analyzer is VB or C# specific). Note that &ldquo;analyzers\dotnet&rdquo; here doesn't follow the same rules as &ldquo;lib\<em>subdirectory</em>&rdquo;... it should be &ldquo;dotnet&rdquo; exactly. (This rule isn't currently enforced, but it might be in future). If you created an analyzer prior to VS2015 RTM (release date July 29th 2015) then I suspect your analyzer NuGet package is out of date. You should do File&gt;New&gt;Extensibility&gt;Analyzer once again and copy+paste your old code.</p>
<p><strong>mscorlib-based projects. </strong>If you want to write a NuGet package which is very portable, including to .NET4-era targets, things get more complicated. (1) When you try to write such a PCL, it is &ldquo;mscorlib&rdquo;-based. That means the DLL contains an assembly reference to &ldquo;mscorlib&rdquo;. I don&rsquo;t know how to figure out which NuGet packages this corresponds to. (2) Such an mscorlib-based PCL cannot be referenced by a dnxcore50 project. Therefore, at the bare minimum, you must build two separate DLLs, one for older project types and one for newer ones. (3) You&rsquo;ll typically want to include references to packages like Microsoft.Bcl and Microsoft.Bcl.Async and Microsoft.Net.Http. I don&rsquo;t know which of these packages should also be depended upon by modern targets.</p>
<p>&nbsp;</p>
<p>&nbsp;</p><div style="clear:both;"></div></div>
