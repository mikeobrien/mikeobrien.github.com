--
layout: post
title: Using the Hosts file and Directory Junctions to Enable Flexibility in Development Environment Configuration
categories: [Build/Deploy, Nant]
tags: [Build/Deploy, Nant]
--
<p>There are a number of ways to setup configuration in the development, pre production and production environments. One way is to maintain independent .config files for different environments\developers and manually copy the appropriate file to the target during deployment. I've never warmed up to this approach as it leads to obvious headaches like difficulty keeping the config files in sync (And making sure everyone is using the most up to date config file), its error prone, and there ends up being many different .config files. I have been using an approach that I really like where there is <em>one and only one</em> .config file for all developers and all environments (Per project of course). Developers all share the same config file and thus the same configuration. When the config file is deployed to different environments, like UAT, staging and production, the deployment NANT script modifies the configuration during deployment (I also enforce a <a href="/2007/11/xml-configuration-for-nant-scripts.html">separation between NAnt script and configuration</a> so setting and maintaining of configuration is fairly trivial). When the config file is modified it is automatically propagated to developers when they do an update and the new schema is guaranteed to make it to all the different environments. Of course the down side to this approach is the same as the up side, every developer has the same configuration... It would really be a pain to force every developer to have a strictly defined development environment; there is no flexibility and leeway for developer preference. In order to get the best of both worlds I've been using the hosts file and symbolic links to "map" the common configuration to the developers configuration.  For example the default developer config (In source control) might look like this:</p><pre class="code"><span style="color: blue"><</span><span style="color: #a31515">configuration</span><span style="color: blue">>
  <</span><span style="color: #a31515">sweetApp</span><span style="color: blue">>
    <</span><span style="color: #a31515">paths</span><span style="color: blue">>
      <</span><span style="color: #a31515">mediaFiles </span><span style="color: red">localPath</span><span style="color: blue">=</span>"<span style="color: blue">C:\SweetCompany\SweetApp\SweetApp.Web.UI\MediaFiles</span>"<span style="color: blue">/>
      <</span><span style="color: #a31515">uploads </span><span style="color: red">localPath</span><span style="color: blue">=</span>"<span style="color: blue">C:\SweetCompany\SweetApp\Uploads</span>"<span style="color: blue">/>
    </</span><span style="color: #a31515">paths</span><span style="color: blue">>
    <</span><span style="color: #a31515">web</span><span style="color: blue">>
      <</span><span style="color: #a31515">sites </span><span style="color: red">errorPage</span><span style="color: blue">=</span>"<span style="color: blue">/SystemMessage.aspx</span>"<span style="color: blue">>
        <</span><span style="color: #a31515">main </span><span style="color: red">domainName</span><span style="color: blue">=</span>"<span style="color: blue">www.dev.sweetapp.com</span>" <span style="color: blue">/>
        <</span><span style="color: #a31515">services </span><span style="color: red">domainName</span><span style="color: blue">=</span>"<span style="color: blue">services.dev.sweetapp.com</span>" <span style="color: blue">/>
        <</span><span style="color: #a31515">administration </span><span style="color: red">domainName</span><span style="color: blue">=</span>"<span style="color: blue">admin.dev.sweetapp.com</span>" <span style="color: blue">/>
</span><span style="color: blue">      </</span><span style="color: #a31515">sites</span><span style="color: blue">>
    </</span><span style="color: #a31515">web</span><span style="color: blue">>
  </</span><span style="color: #a31515">sweetApp</span><span style="color: blue">>
  <</span><span style="color: #a31515">system.net</span><span style="color: blue">>
    <</span><span style="color: #a31515">mailSettings</span><span style="color: blue">>
      <</span><span style="color: #a31515">smtp </span><span style="color: red">deliveryMethod</span><span style="color: blue">=</span>"<span style="color: blue">Network</span>" <span style="color: red">from</span><span style="color: blue">=</span>"<span style="color: blue">admin@sweetapp.com</span>"<span style="color: blue">>
        <</span><span style="color: #a31515">network </span><span style="color: red">host</span><span style="color: blue">=</span>"<span style="color: blue">smtp.dev.sweetapp.com</span>" <span style="color: red">port</span><span style="color: blue">=</span>"<span style="color: blue">25</span>" 
                 <span style="color: red">defaultCredentials</span><span style="color: blue">=</span>"<span style="color: blue">true</span>"<span style="color: blue">/>
      </</span><span style="color: #a31515">smtp</span><span style="color: blue">>
    </</span><span style="color: #a31515">mailSettings</span><span style="color: blue">>
  </</span><span style="color: #a31515">system.net</span><span style="color: blue">>
</</span><span style="color: #a31515">configuration</span><span style="color: blue">></span></pre><a href="http://11011.net/software/vspaste"></a>
<p>The hosts file, under %SystemRoot%\system32\drivers\etc\, allows you to point a network name to an IP address (You probably already know this...). So in the example above the developer could add to the following to their host file. </p>
<p><font face="Courier New" size="2"># SweetApp Dev Mappings<br>127.0.0.1          www.dev.sweetapp.net<br>127.0.0.1     services.dev.sweetapp.net<br>127.0.0.1        admin.dev.sweetapp.net<br>127.0.0.1         smtp.dev.sweetapp.net</font></p>
<p>This will of course map all these network names the local machine. But if, for example, the developer wanted to run parts of their environment in a VM or on another box altogether they could easily point to the IP address elsewhere. If your creating a hosts file entry for your local SQL Server that you will be connecting to with Windows Auth, be sure to setup an alias as described <a href="/PermaLink,guid,3ff5516a-ea11-49e4-b7fe-33fd9f9169bb.aspx">here</a></p>
<p>The other issue is paths. I personally keep all my "data" (Including code) under a second partition. And I like to keep things under a particular folder structure. Others may not roll this way and have different path/drive preferences. Using directory junctions you can create a "shortcut" to another folder. This can be easily accomplished with the mklink command in Vista/Server 08 (In XP and earlier there is another utility in the resource kit but I forget the name.) For the above example you could issue the following command to create a junction that links to a working folder on the D: drive. </p>
<p><font face="Courier New" size="2">mklink /J c:\SweetCompany\SweetApp d:\Dev\WorkApps\SweetApp</font></p>
<p>This essentially maps the first folder to the second folder so the path references in the config file will be valid but the developer can work out of the path they choose. You can also accomplish something similar with the subst command (Which maps a drive letter to a path). The problem with this approach is that the mapping is only recognized in the current login session. An ASP.NET page, for example, will know nothing about it since its running under the logon session of its process identity. </p>