--
layout: post
title: Installing ThoughtWorks Cruise with Active Directory Authentication on Windows
categories: [ThoughtWorks Cruise, Active Directory]
tags: [ThoughtWorks Cruise, Active Directory]
--
<p>This post is pretty much a carbon copy of my <a href="/2009/08/installing-thoughtworks-cruise-with.html">last post on file based authentication</a> except for the AD specific instructions.</p> <span style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium 'Times New Roman'; white-space: normal; orphans: 2; letter-spacing: normal; color: rgb(0,0,0); word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px" class="Apple-style-span"><span style="line-height: 16px; font-family: 'trebuchet MS', verdana; font-size: 11px" class="Apple-style-span">     <p><a style="color: rgb(113,150,159); font-weight: bold; text-decoration: none" href="http://blog.mikeobrien.net/ct.ashx?id=18e56195-1b67-432d-90ad-b9f1df501547&url=http%3a%2f%2fstudios.thoughtworks.com%2fcruise-release-management">ThoughtWorks Cruise</a><span class="Apple-converted-space"> </span>is a compelling option for continuous integration. Even more compelling is that they offer a free version (Although their recent marketing has been somewhat ambiguous on this, see<span class="Apple-converted-space"> </span><a style="color: rgb(113,150,159); font-weight: bold; text-decoration: none" href="http://blog.mikeobrien.net/ct.ashx?id=18e56195-1b67-432d-90ad-b9f1df501547&url=http%3a%2f%2fcommunity.thoughtworks.com%2fposts%2fe104868115">here</a><span class="Apple-converted-space"> </span>for more info). Setting up Cruise with Active Directory authentication is fairly simple but hopefully this post will expand on the AD setup.</p>      <p>1)<span class="Apple-converted-space"> </span><strong>Download the latest version of the Cruise Server and Cruise Agent<span class="Apple-converted-space"> </span></strong><a style="color: rgb(113,150,159); font-weight: bold; text-decoration: none" href="http://blog.mikeobrien.net/ct.ashx?id=18e56195-1b67-432d-90ad-b9f1df501547&url=http%3a%2f%2fstudios.thoughtworks.com%2fuser%2fregister%26destination%3dforms%2fform%2fcruise%2fdownload">here</a><strong>.</strong><span class="Apple-converted-space"> </span>Fill out the form and you will be redirected to a download page. You will also be emailed a license that is good for a year. You will have to renew this license every year. From what I have been told, your Cruise server will not stop working after a year, but you will not be able to make any changes to your pipelines until you have an updated license. Kind of a pain but I think it’s worth it for a free product.</p>      <p>2)<strong><span class="Apple-converted-space"> </span>Install both the Cruise Server and Cruise Agent.</strong><span class="Apple-converted-space"> </span>The Cruise server coordinates the builds and the Cruise Agent actually performs tasks. So you could potentially have multiple agents on multiple servers which are handling build tasks in parallel. The free version only allows you to install agents on the same machine as the Cruise Server. The simplest Cruise install is Cruise Server and 1 Cruise Agent.</p>      <p>3)<span class="Apple-converted-space"> </span><strong>Enter your license key.</strong><span class="Apple-converted-space"> </span>Browse to the administrative control pane (<u><font color="#0066cc"><a style="color: rgb(113,150,159); font-weight: bold; text-decoration: none" href="http://blog.mikeobrien.net/ct.ashx?id=18e56195-1b67-432d-90ad-b9f1df501547&url=http%3a%2f%2flocalhost%3a8153">http://localhost:8153</a></font></u>) or by double clicking the icon on your desktop. The control panel can also be accessed over ssl by using port 8154:<span class="Apple-converted-space"> </span><u><font color="#0066cc"><a style="color: rgb(113,150,159); font-weight: bold; text-decoration: none" href="http://blog.mikeobrien.net/ct.ashx?id=18e56195-1b67-432d-90ad-b9f1df501547&url=https%3a%2f%2flocalhost%3a8154">https://localhost:8154</a></font></u>. This will redirect to the about page where you will need to enter your license information. You should have received a user name and license key by email. Enter the user name (Called “Licensee” in the email) and paste in the license key in appropriate box and press “Save license”.</p>      <p><span style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium 'Times New Roman'; white-space: normal; orphans: 2; letter-spacing: normal; color: rgb(0,0,0); word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px" class="Apple-style-span"><span style="line-height: 16px; font-family: 'trebuchet MS', verdana; font-size: 11px" class="Apple-style-span">5)<span class="Apple-converted-space"> </span><strong>Set the Active Directory information in the Cruise configuration.</strong><span class="Apple-converted-space"> </span>Now you will need to click on the “ADMINISTRATION” tab in the Cruise control panel then the “Source XML” sub tab. Here you will see the xml configuration for Cruise. Click the “Edit” button at the top of the file to make the textbox editable. Now add the following “security” section to the configuration:</span></span></p>     <span style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium 'Times New Roman'; white-space: normal; orphans: 2; letter-spacing: normal; color: rgb(0,0,0); word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px" class="Apple-style-span"><span style="line-height: 16px; font-family: 'trebuchet MS', verdana; font-size: 11px" class="Apple-style-span"><span style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium 'Times New Roman'; white-space: normal; orphans: 2; letter-spacing: normal; color: rgb(0,0,0); word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px" class="Apple-style-span"><span style="line-height: 16px; font-family: 'trebuchet MS', verdana; font-size: 11px" class="Apple-style-span">             <pre class="code"><span style="color: blue"><?</span><span style="color: rgb(163,21,21)">xml </span><span style="color: red">version</span><span style="color: blue">=</span>"<span style="color: blue">1.0</span>" <span style="color: red">encoding</span><span style="color: blue">=</span>"<span style="color: blue">utf-8</span>"<span style="color: blue">?>
<</span><span style="color: rgb(163,21,21)">cruise </span><span style="color: red">... </span><span style="color: blue">>
  <</span><span style="color: rgb(163,21,21)">server </span><span style="color: red">artifactsdir</span><span style="color: blue">=</span>"<span style="color: blue">logs</span>"<span style="color: blue">>
    </span>...
    <span style="color: blue"><</span><span style="color: rgb(163,21,21)">security</span><span style="color: blue">>
      <</span><span style="color: rgb(163,21,21)">ldap </span><span style="color: rgb(163,21,21)">        </span>
        <span style="color: red">uri</span><span style="color: blue">=</span>"<span style="color: blue">ldap://MyADServer</span>"<font color="#a31515"> <span style="color: rgb(163,21,21)">        </span></font>
        <span style="color: red">managerDn</span><span style="color: blue">=</span>"<span style="color: blue">MyDomain\MyADUser</span>"<font color="#a31515"> <span style="color: rgb(163,21,21)">        </span></font>
        <span style="color: red">managerPassword</span><span style="color: blue">=</span>"<span style="color: blue">P@$$W0rd</span>"<font color="#a31515"> <span style="color: rgb(163,21,21)">        </span></font>
        <span style="color: red">searchBase</span><span style="color: blue">=</span>"<span style="color: blue">CN=Users, DC=intranet, DC=mycompany, DC=com</span>"<font color="#a31515"> <span style="color: rgb(163,21,21)">        </span></font>
        <span style="color: red">searchFilter</span><span style="color: blue">=</span>"<span style="color: blue">(sAMAccountName={0})</span>" <span style="color: blue">/>
    </</span><span style="color: rgb(163,21,21)">security</span><span style="color: blue">>
    </span>...
  <span style="color: blue"></</span><span style="color: rgb(163,21,21)">server</span><span style="color: blue">>
  </span>...
<span style="color: blue"></</span><span style="color: rgb(163,21,21)">cruise</span><span style="color: blue">></span></pre>
          </span></span></span></span>

    <p><span style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium 'Times New Roman'; white-space: normal; orphans: 2; letter-spacing: normal; color: rgb(0,0,0); word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px" class="Apple-style-span"><span style="line-height: 16px; font-family: 'trebuchet MS', verdana; font-size: 11px" class="Apple-style-span"><span style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium 'Times New Roman'; white-space: normal; orphans: 2; letter-spacing: normal; color: rgb(0,0,0); word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px" class="Apple-style-span"><span style="line-height: 16px; font-family: 'trebuchet MS', verdana; font-size: 11px" class="Apple-style-span">The following is an explanation of the settings:</span></span></span></span></p>

    <p><span style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium 'Times New Roman'; white-space: normal; orphans: 2; letter-spacing: normal; color: rgb(0,0,0); word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px" class="Apple-style-span"><span style="line-height: 16px; font-family: 'trebuchet MS', verdana; font-size: 11px" class="Apple-style-span"><span style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium 'Times New Roman'; white-space: normal; orphans: 2; letter-spacing: normal; color: rgb(0,0,0); word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px" class="Apple-style-span"><span style="line-height: 16px; font-family: 'trebuchet MS', verdana; font-size: 11px" class="Apple-style-span"><strong>uri</strong>: This is simply a server running AD specified as an ldap url. So if your AD server is “AD1” then it would be “ldap://AD1”.</span></span></span></span></p>

    <p><span style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium 'Times New Roman'; white-space: normal; orphans: 2; letter-spacing: normal; color: rgb(0,0,0); word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px" class="Apple-style-span"><span style="line-height: 16px; font-family: 'trebuchet MS', verdana; font-size: 11px" class="Apple-style-span"><span style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium 'Times New Roman'; white-space: normal; orphans: 2; letter-spacing: normal; color: rgb(0,0,0); word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px" class="Apple-style-span"><span style="line-height: 16px; font-family: 'trebuchet MS', verdana; font-size: 11px" class="Apple-style-span"><strong>managerDn and managerPassword</strong>: This is an AD account that is able to query the AD server. You can create a domain account that is in the “Domain Users” group (Which is the default for new domain users) and this will do the trick, no special permissions needed.</span></span></span></span></p>

    <p><span style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium 'Times New Roman'; white-space: normal; orphans: 2; letter-spacing: normal; color: rgb(0,0,0); word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px" class="Apple-style-span"><span style="line-height: 16px; font-family: 'trebuchet MS', verdana; font-size: 11px" class="Apple-style-span"><span style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium 'Times New Roman'; white-space: normal; orphans: 2; letter-spacing: normal; color: rgb(0,0,0); word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px" class="Apple-style-span"><span style="line-height: 16px; font-family: 'trebuchet MS', verdana; font-size: 11px" class="Apple-style-span"><strong>searchBase</strong>: This is the starting point in Active Directory to look for users to authenticate. It reads from right to left (The opposite of a URI). If your domain is “intranet.mycompany.com” then each sub domain will be specified separately as shown above (Reading from left to right). If you have a really simple domain setup, all of your users will probably be in the “Users” container identified by “CN”. If your setup is more organized, then users will be placed in organizational units. So for example lets say we have an organization unit under the domain in our example called “MyCompanyInc” and another organization unit under that called “Developers” and you only want users in that organization unit to access Cruise. In that case the searchBase would be “OU=Developers, OU=MyCompanyInc, DC=intranet, DC=mycompany, DC=com”.</span></span></span></span></p>

    <p><span style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium 'Times New Roman'; white-space: normal; orphans: 2; letter-spacing: normal; color: rgb(0,0,0); word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px" class="Apple-style-span"><span style="line-height: 16px; font-family: 'trebuchet MS', verdana; font-size: 11px" class="Apple-style-span"><span style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium 'Times New Roman'; white-space: normal; orphans: 2; letter-spacing: normal; color: rgb(0,0,0); word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px" class="Apple-style-span"><span style="line-height: 16px; font-family: 'trebuchet MS', verdana; font-size: 11px" class="Apple-style-span"><strong>searchFilter</strong>: This is the search criteria, the simplest matching the username (As shown in above and in the docs). </span></span></span></span></p>

    <p><span style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium 'Times New Roman'; white-space: normal; orphans: 2; letter-spacing: normal; color: rgb(0,0,0); word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px" class="Apple-style-span"><span style="line-height: 16px; font-family: 'trebuchet MS', verdana; font-size: 11px" class="Apple-style-span"><span style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium 'Times New Roman'; white-space: normal; orphans: 2; letter-spacing: normal; color: rgb(0,0,0); word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px" class="Apple-style-span"><span style="line-height: 16px; font-family: 'trebuchet MS', verdana; font-size: 11px" class="Apple-style-span">Click the save button and browse to another page in the admin. At this point you should be greeted with a login page.</span></span></span></span></p>
  </span></span>