--
layout: post
title: Stripping out the date or time portion from a SQL datetime value
categories: [TSQL/SQL Server]
tags: [TSQL/SQL Server]
--
<P>Here is a little trick that will “strip” (In reality zero out) the date or time portion from a datetime value. Basically the SQL datetime is just two 4 byte integers. When you convert a datetime to a float the integer portion represents the date (Which is the number of days since 1/1/1900) and the fractional portion represents the time (The number of 3 millisecond increments that have elapsed since midnight). To zero out one or the other simply requires removing the integer or fractional portion then converting that back into a datetime. The following illustrates this:</P><FONT color=#0000ff size=2>
<P><FONT face="Courier New">DECLARE</FONT></FONT><FONT face="Courier New" color=#000000 size=2> @DateTime </FONT><FONT color=#0000ff size=2><FONT face="Courier New">float</FONT></P>
<P><FONT face="Courier New">SET</FONT></FONT><FONT face="Courier New"><FONT color=#000000 size=2> @DateTime </FONT><FONT color=#808080 size=2>=</FONT><FONT color=#000000 size=2> </FONT><FONT color=#ff00ff size=2>CAST</FONT><FONT color=#808080 size=2>(</FONT><FONT color=#ff00ff size=2>GETDATE</FONT><FONT color=#808080 size=2>()</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>AS</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>FLOAT</FONT><FONT color=#808080 size=2>)</P></FONT></FONT><FONT color=#008000 size=2>
<P><FONT face="Courier New">/* Date & Time */<BR></FONT></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>SELECT</FONT><FONT color=#000000 size=2> </FONT><FONT color=#ff00ff size=2>CAST</FONT><FONT color=#808080 size=2>(</FONT><FONT color=#000000 size=2>@DateTime </FONT><FONT color=#0000ff size=2>AS</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>datetime</FONT><FONT color=#808080 size=2>)</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>AS</FONT><FONT size=2><FONT color=#000000> DateAndTime</FONT></P></FONT></FONT><FONT color=#008000 size=2>
<P><FONT face="Courier New">/* Date only */<BR></FONT></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>SELECT</FONT><FONT color=#000000 size=2> </FONT><FONT color=#ff00ff size=2>CAST</FONT><FONT color=#808080 size=2>(</FONT><FONT color=#ff00ff size=2>FLOOR</FONT><FONT color=#808080 size=2>(</FONT><FONT color=#000000 size=2>@DateTime</FONT><FONT color=#808080 size=2>)</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>AS</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>datetime</FONT><FONT color=#808080 size=2>)</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2><FONT face="Courier New"><FONT color=#000000> DateOnly</FONT> </FONT>
<P><FONT face="Courier New"></FONT></P></FONT><FONT color=#008000 size=2>
<P><FONT face="Courier New">/* Time only */<BR></FONT></FONT><FONT face="Courier New"><FONT color=#0000ff size=2>SELECT</FONT><FONT color=#000000 size=2> </FONT><FONT color=#ff00ff size=2>CAST</FONT><FONT color=#808080 size=2>((</FONT><FONT color=#000000 size=2>@DateTime </FONT><FONT color=#808080 size=2>-</FONT><FONT color=#000000 size=2> </FONT><FONT color=#ff00ff size=2>FLOOR</FONT><FONT color=#808080 size=2>(</FONT><FONT color=#000000 size=2>@DateTime</FONT><FONT color=#808080 size=2>))</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>AS</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>datetime</FONT><FONT color=#808080 size=2>)</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>AS</FONT></FONT><FONT size=2><FONT face="Courier New" color=#000000> TimeOnly</FONT></P>
<P></FONT><BR>I think this is much cleaner than the common method of converting the datetime to a varchar, truncating the date or time portion, then converting the varchar back to a datetime. You can read more about the datetime data type <A href="http://msdn2.microsoft.com/en-us/library/ms187819.aspx">here</A> in the BOL.</P>