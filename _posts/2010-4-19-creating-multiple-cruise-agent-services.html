--
layout: post
title: Creating Multiple Cruise Agent Services on the Same Windows Box
categories: [ThoughtWorks Cruise]
tags: [ThoughtWorks Cruise]
--
<p>The <a href="https://build.reachmail.net/cruise/help/admin_install_multiple_agents.html">official procedure for installing multiple Cruise agents on the same box</a> is pretty hokey IMO since it requires a logged on user. You can just run multiple Cruise agents as services which is a much better approach. It’s actually pretty simple:</p>  <ol>   <li>Stop the default Cruise agent service and delete it. (<font face="Courier New">sc delete &quot;Cruise Agent&quot;</font>)       <br />      <br /><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/content/b7eb52ecf5b046418f7aaceafd9cdf9b.png" width="668" height="79" />       <br />      <br /></li>    <li>Create a folder under “[Program Files]” called “Cruise Agents” (<em>Plural</em>, the singular folder is what the installer creates). Under the “[Program Files]\Cruise Agents” (<em>Plural</em>) folder create a folder for each instance you want (I just did “Instance1”, “Instance2” and so on) and then copy the contents of the “[Program Files]\Cruise Agent” (<em>Singular</em>) folder into each of these instance folders. NOTE: As an side I tried to set it up so that there was one bin folder and multiple config folders (Per instance) but gave up after about 15 minutes. If someone knows how to do this it would really simplify things and save on a few hundred mb of disk space.       <br />      <br /><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/content/b88799553ba746279b2c0e3983a4c13c.png" width="707" height="257" />       <br />      <br /></li>    <li>Delete the “[Program Files]\Cruise Agents\Instance<font color="#ff0000">N</font>\config\guid.txt” file in each of the instance folders if it exists. A fresh guid will be automatically generated when the instance starts. (“<font color="#ff0000">N</font>” being the instance number) </li>    <li>Delete the “[Program Files]\Cruise Agents\Instance<font color="#ff0000">N</font>\<span style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium &#39;Times New Roman&#39;; white-space: normal; orphans: 2; letter-spacing: normal; color: rgb(0,0,0); word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px" class="Apple-style-span"><span style="line-height: 19px; font-family: verdana, sans-serif; font-size: 13px" class="Apple-style-span">.agent-bootstrapper.running” file in each of the instance folders if it exists.</span></span> </li>    <li>Open the “[Program Files]\Cruise Agents\Instance<font color="#ff0000">N</font>\config\wrapper-agent.conf” file for each instance and make the following modifications :       <ol>       <li>wrapper.java.command=C:\Program Files (x86)\Cruise Agents\Instance<font color="#ff0000">N</font>\jdk\bin\java </li>        <li>wrapper.ntservice.name=Cruise Agent<font color="#ff0000">N</font> </li>        <li>wrapper.ntservice.displayname=Cruise Agent <font color="#ff0000">N</font> </li>        <li>wrapper.ntservice.description=Cruise Agent <font color="#ff0000">N</font> </li>     </ol>   </li>    <li>Now create a windows service for each of your instances (<font face="Courier New">sc create &quot;Cruise Agent<font color="#ff0000">N</font>&quot; binPath= &quot;\&quot;C:\Program Files (x86)\Cruise Agents\Instance<font color="#ff0000">N</font>\cruisewrapper.exe\&quot; -s \&quot;C:\Program Files (x86)\Cruise Agents\Instance<font color="#ff0000">N</font>\config\wrapper-agent.conf\&quot;&quot; DisplayName= &quot;Cruise Agent 1&quot; start= auto</font>):       <br />      <br /><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/content/9484e92199be4b2fb8ccd072f9e57428.png" width="668" height="175" />      <br />      <br /></li>    <li>Start the services and you should be good to go. You may need to delete the old instance definition from the Cruise config file so it doesn't show up in the list. </li> </ol>  