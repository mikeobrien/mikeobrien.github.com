---
layout: post
title: Adding Build Time and Error Details to TeamCity Email Notifications
categories: [TeamCity]
tags: [TeamCity]
---
<p>After setting up TeamCity I wanted to add some more information to the notification email. TeamCity allows you to customize all notifications (Not just email) through templates. The following resources were helpful in figuring out how to do this:</p>  <p><a href="http://confluence.jetbrains.net/display/TCD65/Customizing+Notifications">TeamCity: Customizing Notifications Templates</a></p>  <p><a href="http://confluence.jetbrains.net/display/TCD65/Server-side+Object+Model">TeamCity: Server-side Object Model</a></p>  <p><a href="http://freemarker.org/docs/index.html">FreeMarker Manual (Templating engine)</a></p>  <p>First I wanted to add build time to the subject of successful build notifications so that we could easily monitor it:</p>  <p>build_successful.ftl:</p>  <p><font face="Consolas">&lt;#global subject&gt;${project.name} ${buildType.name} v${build.buildNumber} Succeeded </font></p>  <p><font face="Consolas">(${((build.duration / 60) % 60)}:${((build.duration) % 60)?string?left_pad(2, &quot;0&quot;)})&lt;/#global&gt;</font></p>  <p>This will give you a subject along the lines of:</p>  <p><font face="Consolas">Frogger Stable CI v1.0.0.331 Succeeded (11:58)</font></p>  <p>When a build fails, TeamCity will include failed test results in the email but not other failure information. I wanted to add the failure summary (Like the one seen on the build summary page) in every failed build notification:</p>  <p>build_failed.ftl</p>  <p><font face="Consolas">&lt;#global bodyHtml&gt;     <br />&#160;&#160;&#160; ...      <br />&#160;&#160;&#160; &lt;div style=&quot;color:red&quot;&gt;      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;#list build.buildLog.errorMessages as message&gt;      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ${message.text?replace(&quot;\n&quot;, &quot;\lbr/\g&quot;)}&lt;br/&gt;      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/#list&gt;      <br />&#160;&#160;&#160; &lt;/div&gt;      <br />&#160;&#160;&#160; ...      <br />&lt;/#global&gt;</font></p>  <p>This will give you a notification along the lines of:</p>  <p><font face="Consolas">Build Frogger::Stable CI #1.0.0.336 failed     <br />Agent: ENDOR1</font></p>  <p><font color="#ff0000" face="Consolas">bt3     <br />Execute build_projects_ui      <br />RuntimeError: MSBuild Failed. See Build Log For Detail</font></p>  <p><font color="#ff0000" face="Consolas">Stacktrace:     <br />C:/.../gems/albacore-0.2.7/lib/albacore/support/failure.rb:12:in `fail_with_message'      <br />... stack trace ...      <br />C:/Program Files/TeamCity/BuildAgent1/plugins/rake-runner/lib/rb/runner/rakerunner.rb:40:in `'      <br />Rake aborted!</font></p>  <p><font face="Consolas">Changes included (2 changes).     <br />Change f735f1f299dc10005d8cc33d80003ea6915cbfa4 by mobrien (2 files): Added frog.      <br />Change 4b023210511568f5159a28e493ec01134285c363 by mobrien (1 file): Added cars.</font></p>  