---
layout: post
title: Using Git Locally on Windows with a Central SVN Repository
tags: [Git, Subversion]
---
<p align="justify">There is a lot of into out there on this subject so the following post is mainly just a brain dump that I can refer back too. Plus I'm pretty green with git so I cannot guarantee that I actually know what I'm talking about. Maybe you will find it useful, but I'm not promising anything. :) </p>  <p align="justify">We have a central SVN repository and I want to use Git locally but push/fetch to/from the central svn repo. Sam Vilain has a <a href="http://utsl.gen.nz/talks/git-svn/intro.html">nice tutorial discussing how to integrate Git with svn</a> (If its not available try <a href="http://web.archive.org/web/20080822015636/http://utsl.gen.nz/talks/git-svn/intro.html">here</a>) as does <a href="http://learn.github.com/p/git-svn.html">GitHub</a>. Also check out Jason Meridth's blog series, <a href="http://www.lostechies.com/blogs/jason_meridth/archive/2009/06/01/git-for-windows-developers-git-series-part-1.aspx">Git for Windows Developers</a>; very nice tutorial on Git in general, and where I got a lot of my info from. </p>  <p><strong><font size="3">Install msysgit</font></strong></p>  <p>You will need to install <a href="http://code.google.com/p/msysgit/downloads/list">msysgit</a>. Here are some notes:</p>  <ul>   <li>     <div align="justify">I've found the "Get Bash Here" explorer context menu to be handy; this can be installed by selecting the option in the "Select Components" installer dialog, under "Windows Explorer Integration". </div>   </li>    <li>     <div align="justify">I suggest selecting the "Run Git from the Windows Command Prompt" option in the "Adjusting your PATH environment" installer dialog. This will allow you to run Git from the command line. I personally use the bash shell but I figure it wouldn't hurt to have Git available on the command line as well if needed. </div>   </li>    <li>I've chosen not to have Git adjust the line endings as we are not doing cross platform development. </li> </ul>  <p><strong><font size="3">Configure Git</font></strong></p>  <p align="justify">You can access the bash shell anywhere by right clicking a folder in explorer and clicking "Git Bash Here". Right click the parent folder that you want to contain the source folder (Created by the clone command in the next section). </p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/dc08e3e748f1460eb1cca1beaf891816.png" width="460" height="255" /> </p>  <p>Once you open your bash shell you will need to set your name and email. This can be configured at 2 levels, global and local. The global values work as the default whereas the local values are specific to a repository. It's a good idea to set a global name and email, and where you need to, set a local one. The following demonstrates setting the global values:</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/49f25194730243d38fe5b828392291f2.png" width="565" height="227" /> </p>  <p>The syntax for setting the local name and email is the same as the global except you leave out the &#8211;-global flag. Make sure you are in the project folder when you set the local name and email:</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/1e2971510b2847c8a69a238c9616d85c.png" width="541" height="143" /> </p>  <p>All the following will be performed in the bash shell.</p>  <p><strong><font size="3">Clone the SVN Repo</font></strong></p>  <p align="justify">In Sam's tutorial he discusses a few ways to init your local Git repo. In my case I wanted a full copy of our svn repo with history. To do this you can <a href="http://kernel.org/pub/software/scm/git/docs/git-svn.html">clone</a> the SVN repository with the <font color="#0000ff" face="Courier New">git svn clone</font> command. The clone command does a <font color="#0000ff" face="Courier New">git svn init</font> and then a <font color="#0000ff" face="Courier New">git svn fetch</font>, all in one command. If you are trying to clone directly from the repository files, you will (as of the date of this post) run into the error "<em>Permission denied: Can't open '/tmp/report.tmp': Permission denied at C:\Program Files\Git/libexec/git-core/git-svn line 2685</em>". I worked around this by installing svnsrv locally and accessing the repository via svnserve (instead of directly on the file system). You can perform the clone as follows:</p>  <p><font color="#0000ff" face="Courier New">git svn clone &#8211;T trunk svn://&lt;HostName&gt;/&lt;RepoName&gt;</font></p>  <p align="justify">In this example I only want to track the trunk so only that folder is specified with the &#8211;T flag. You can also track branches and tags if you'd like by adding the corresponding flags. But if you just want the root of the svn repo (If you not using the "standard" folder layout) you can just leave out the trunk/branches/tags options:</p>  <p><font color="#0000ff" face="Courier New">git svn clone svn://&lt;HostName&gt;/&lt;RepoName&gt;</font></p>  <p align="justify">This operation can take a while depending on the size of your repo (Into the hours or even days). I just opted to zip and download the entire svn repo from our server and do the clone locally instead of over the web. Not 100% sure if this saved time or if it was 6 of one, half dozen of the other. I know for sure it couldn't have been slower so it seemed like a smarter option. Even then, the 325 mb repo took around 8 hours to clone. But from here on out, new Git developers could get a clone from someone who already has one instead creating a new one on their own.</p>  <p align="justify">If you cloned the repo from an alternate source (For example a local copy, like I mentioned doing above) you will need to point the git repo to the correct upstream svn repo. Following the next few steps will do this (More about this <a href="https://git.wiki.kernel.org/index.php/GitSvnSwitch">here</a> where I found the procedure). If you cloned directly from the upstream svn repo then you can skip these next steps.</p>  <ol>   <li>     <div align="justify">Edit the svn-remote url in \.git\config to point to the <strong><em><font color="#ff0000">new</font></em></strong> url (Remember the url is just the url to the repository, do not include "trunk" or a subfolder):         <p><font face="Courier New">...            <br />[svn-remote &quot;svn&quot;]             <br />&#160;<strong><font color="#ff0000">url = https://svn.someserver.com/projecteulernet</font></strong>             <br />fetch = :refs/remotes/git-svn</font></p>     </div>   </li>    <li>     <div align="left">Run <font color="#0000ff" face="Courier New">git svn fetch</font> (This needs to fetch at least one new revision from svn). The following example demonstrates connecting to an upstream svn server running over https with a self signed cert and basic authentication. As with svn, you can permanently accept the self signed cert when prompted. When prompted for the password (of the default username) you can just hit enter to be prompted for the username.         <br /><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/57cccf1dd64d467d854f32392228efcb.png" width="677" height="330" /> </div>   </li>    <li>     <div align="justify">Now go back again and edit the svn-remote url in \.git\config to point to the <em><strong><font color="#ff0000">old</font></strong></em> url.</div>   </li>    <li>     <div align="left">Run <font color="#0000ff" face="Courier New">git svn rebase -l</font> to do a local rebase (with the changes that came in with the last fetch operation):         <br /><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/c7edba7c47f94f5fb796837cc05ec551.png" width="548" height="116" /> </div>   </li>    <li>     <div align="left">       <div align="justify">One final time, go back and edit the svn-remote url in \.git\config to point to the <strong><em><font color="#ff0000">new</font></em></strong> url.</div>     </div>   </li>    <li>     <div align="left">       <div align="justify">Run <font color="#0000ff" face="Courier New">git svn rebase</font> and you should be good to go:           <br /><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/e36e0418c33d4fe09db8904e2351e70c.png" width="548" height="116" /> </div>     </div>   </li> </ol>  <p></p>  <p><font face="Courier New"></font></p>  <p><font face="Courier New"></font></p> Now git svn will work against the new upstream svn url you specified.   <p></p>  <p><strong><font size="3">Ignored files</font></strong></p>  <p align="justify">Git ignores files that are specified in a file called ".gitignore". You can place this file at the project root to specify globally ignored file patterns. To create this file, change to the project directory, and use the <font color="#0000ff" face="Courier New">touch</font> command (Windows doesn't like to create it because it starts with a period):</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/de4fa312581f49cabe618e4166a5cb97.png" width="549" height="115" /> </p>  <p>You will need to add the patterns you want ignored, on separate lines, to the file you just created. For example:</p>  <p><font face="Courier New">obj      <br />bin       <br />_ReSharper.*       <br />*.user       <br />*.suo </font></p>  <p></p>  <p></p>  <p></p>  <p></p>  <p>This only needs to be done once. The file will be committed to the repository and be automatically applied to everyone else once they fetch it.</p>  <p><strong><font size="3">Committing Changes</font></strong></p>  <p>After the clone, change to the project folder and run <font color="#0000ff" face="Courier New">git status</font>:</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/0f7a32b8d9b347e1bc1b1fc6dd15bec1.png" width="453" height="129" /> </p>  <p>Next make a change and run <font color="#0000ff" face="Courier New">git status</font> again (In this case I removed a file and updated the ignored file filters):</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/237de1ebea0f43259d27e45a3e4d48c2.png" width="677" height="224" /> </p>  <p></p>  <p></p>  <p></p>  <p align="justify"><font color="#0000ff" face="Courier New">git status</font> now shows some modifications. We want to commit these files to the local repo but first we will need to add these files to the index. The index is a staging area for files we want to commit. When we commit, we commit from the staging area, <em>not the working folder</em>. That's why we add files to the index first. That being said, if you make change to a file that has already been added to the index, this new change will not be picked up by a commit, only the previous change(s). If you want the new change to be committed you would need to add the file to the index again. The <font color="#0000ff" face="Courier New">git add</font> command adds files to the index. This command is followed by a pattern to filter the files being added. You can get fancy with this filter but for the simplicities sake we'll just use the period which means all changed files. This command does not echo a response. </p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/c8dac6ca585e4bc595bc34286f5fea34.png" width="525" height="115" /> </p>  <p>Now lets check the status:</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/a4e87f40c1d941e7a2c27607fb71a34f.png" width="662" height="283" /> </p>  <p></p>  <p align="justify">We can see the two modified files have been added to the index, ready to be committed. You'll notice though that there is a file in there that has been deleted by Visual Studio but is not marked in the index to be deleted. You can mark already deleted files in the index by using the &#8211;A flag instead of the dot (See the bottom of <a href="http://www.kernel.org/pub/software/scm/git/docs/git-rm.html">this page</a> for more info). The -A flag adds all files in the working folder, already added to the index or not, that have been modified, added or deleted.</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/44e6413fb3b84066a50a18ea3df7cda2.png" width="525" height="101" /> </p>  <p>Now check the status:</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/abe073cb92384d7887cecc51ede0b999.png" width="605" height="227" /> </p>  <p></p>  <p>At this point we have all the changes we want committed added to the index. Now lets commit these changes:</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/469762f15f6c4094b5bf652370670847.png" width="549" height="157" /> </p>  <p>Checking the status again we see there are no changes to commit:</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/6cc17353be5c4a0abe9a6ceb42c64398.png" width="549" height="129" /> </p>  <p><strong><font size="3">What is Rebasing and Why Should I Care?</font></strong></p>  <p align="justify">Before we move on we need to discuss rebasing. Git allows you to merge branches and have a <strong><em>non linear</em></strong> history using the <font color="#0000ff" face="Courier New">git merge</font> command. But because of the functionality mismatch between svn and Git in regards to how history is recorded, we need to have linear history in the branch that is tied to an upstream svn repo. <a href="http://learn.github.com/p/git-svn.html">Github's tutorial on using Git with svn</a> notes "<em><font color="#000040">Do not dcommit Git merge commits to the Subversion repository. Subversion doesn't handle merges in the same way as Git, and this will cause problems. This means you should keep your Git development history linear (i.e., no merging from other branches, just rebasing)</font></em>". Also the <a href="http://kernel.org/pub/software/scm/git/docs/git-svn.html">Git-svn man page</a> states "<em><font color="#000040">Running git merge or git pull is NOT recommended on a branch you plan to dcommit from. Subversion does not represent merges in any reasonable or useful fashion; so users using Subversion cannot see any merges you've made</font></em>". As an aside, dcommit is the command used to push changes to the upstream svn repo, we discuss this later. So to create a linear history in a branch, and play nice with svn, you will need to <strong><em>rebase</em></strong> instead of merge when moving changes into that branch from another branch. The git rebase command is described in more detail <a href="http://www.gitready.com/intermediate/2009/01/31/intro-to-rebase.html">here</a>, <a href="http://darwinweb.net/articles/86">here</a> and <a href="http://www.eecs.harvard.edu/~cduan/technical/git/git-5.shtml">here</a>. How does a rebase differ from a merge? Nick Quaranto's <a href="http://www.gitready.com/intermediate/2009/01/31/intro-to-rebase.html">intro to rebase</a> covers it very nicely; I'd suggest jumping over to his site and reading the <a href="http://www.gitready.com/intermediate/2009/01/31/intro-to-rebase.html">entire post</a>. Below I shamelessly rip off a few of the images from <a href="http://www.gitready.com/intermediate/2009/01/31/intro-to-rebase.html">his post</a> that helped me to better understand visually:</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/c96c2fcab5e94a01b18afe42ad4e45c2.png" width="628" height="297" /> </p>  <p>So in the example above, we have the "master" branch and a branch called "newfeature" (Top). If we <em><strong>merge</strong></em> the "newfeature" branch into the "master" branch it preserves the branch history (Which is non-linear) and does one big commit back into master. <strong><em>Rebase</em></strong> on the other hand temporally (As in time; not "temporarily") replays the commits from the other branch onto master and eliminates the other branch altogether (Creating one linear history with multiple commits). Svn doesn't like the former but plays nice with the latter. </p>  <p>So there are 2 scenarios when integrating with svn where you will need to use rebase. First, if you have a local branch and you want to move changes from that branch into another local branch that is tied to an upstream svn repo. And second, when you grab changes from the upstream svn repo and move them into the branch that is tied to it. The latter is discussed next. </p>  <p>Apart from those two scenarios it's up to you whether you want to merge or rebase other branches. </p>  <p><strong><font size="3">Grabbing Changes from the SVN Repo</font></strong></p>  <p>Before we move our changes to the remote SVN repo we will need to grab updates from it, so we'll cover this topic now. To do this we will use the<font color="#0000ff" face="Courier New"> git svn rebase</font> command. The <font color="#000080" face="Courier New">git svn rebase</font> command calls <font color="#0000ff" face="Courier New">git svn fetch</font> and then <font color="#0000ff" face="Courier New">git rebase</font> (Discussed in the last section). The <a href="http://kernel.org/pub/software/scm/git/docs/git-svn.html">git-svn man page</a> says this regarding <font color="#0000ff" face="Courier New">git svn rebase</font>: "<em>This works similarly to svn update or git pull except that it <strong>preserves linear history</strong> <strong>with git rebase</strong> instead of git merge for ease of dcommitting with git svn</em>". It also notes "... <em>It is recommended that you run git svn fetch and rebase (not pull or merge) your commits against the latest changes in the SVN repository... you should use git svn rebase to update your work branch instead of git pull or git merge. pull/merge can cause non-linear history to be flattened when committing into SVN, which can lead to merge commits reversing previous commits in SVN.</em>"</p>  <p>Ok, lets perform the rebase:</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/6146e108e5684384ab9aaaef2708fe04.png" width="517" height="115" /> </p>  <p>Nothing too exciting; no updates in the upstream repo. Now lets cause a conflict and call rebase again:</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/fadabca7791f496cb1e4c71581670d9a.png" width="645" height="325" /> </p>  <p>Now this is a bit more exciting. We can resolve this conflict manually (By editing the file in question) or better yet we can resolve the conflict using a 3 way merge tool. The <a href="http://gitguru.com">gitguru</a> has a <a href="http://gitguru.com/2009/02/22/integrating-git-with-a-visual-merge-tool/">nice article on integrating visual merge tools with Git</a> (Including setting up your own custom merge tool). Here are a few tools you have to choose from: <a href="http://kdiff3.sourceforge.net/">kdiff3</a>, <a href="http://tkdiff.sourceforge.net/">tkdiff</a>, <a href="http://meld.sourceforge.net/">meld</a>, <a href="http://furius.ca/xxdiff/">xxdiff</a>, <a href="http://www.gnu.org/software/emacs/manual/html_node/emacs/Overview-of-Emerge.html">emerge</a>, <a href="http://www.vim.org/">vimdiff</a>, <a href="http://www.vim.org/">gvimdiff</a>, <a href="http://www.elliecomputing.com/products/merge_overview.asp">ecmerge</a>, <a href="http://diffuse.sourceforge.net/">diffuse</a>, <a href="http://tortoisesvn.tigris.org/TortoiseMerge.html">tortoisemerge</a>, <a href="http://developer.apple.com/mac/library/documentation/Darwin/Reference/ManPages/man1/opendiff.1.html">opendiff</a>, <a href="http://www.perforce.com/perforce/products/merge.html">p4merge</a>, <a href="http://www.araxis.com/merge/">araxis</a>. The default is vimdiff (If you have nothing else installed). The following will demonstrate how to setup the free Perforce merge tool.</p>  <ol>   <li>Download and run the <a href="http://www.perforce.com/perforce/downloads/index.html">Perforce Visual Client (P4V)</a>. </li>    <li>On the "Select Features" installer dialog, deselect all features except the "Visual Merge Tool (P4Merge)". </li>    <li>Configure the Perforce merge tool in Git (<em>Note: if your using an older version of git you will need to escape the dollar signs with a backslash, IE: &quot;<font face="Courier New">p4merge \$BASE \$LOCAL \$REMOTE \$MERGED</font>&quot;</em>):&#160; <br /><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/4224619ce233476784dae55938509fcc.png" width="557" height="241" /> </li>    <li>Restart your bash shell so that it can pick up the new PATH variable (Which the Perforce installer adds itself to). </li> </ol>  <p>Once you have a merge tool setup you can start the merge process with the <font color="#0000ff" face="Courier New">git mergetool</font> command:</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/f7eddb20cbaf46ccb2fef75a29314ca4.png" width="629" height="199" /> </p>  <p>After you hit enter the Perforce merge tool will pop up and you can handle the merge. When your done, save it and exit. If there are multiple files you will be prompted to merge the other files. When you are done you can continue the rebase with the continue flag:</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/6f30cb76e1a94975a343bf9bb3096f65.png" width="630" height="129" /> </p>  <p>Doing another git status should show that everything is up to date.</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/3acee0e28bad4a00916929d26de2f3f3.png" width="525" height="129" /> </p>  <p><em><font color="#ff0000">UPDATE: Thanks to </font></em><a href="http://twitter.com/dahlbyk"><em><font color="#ff0000">@dahlbyk</font></em></a><em><font color="#ff0000"> for pointing out that you can configure Git to delete the .orig file by setting the global mergetool.keepBackup setting to false. The screen shot above has been updated to include this.</font></em> <strike><em>As an aside Git doesn't automatically delete the original file that was apart of a merge. Not sure why it leaves it behind. In the example above there is a file called readme.txt.orig still laying around. I added a filter to ignore files with the .orig extension (Earlier in this post) so they will not come up as unversioned. Anyways, just be aware that there will be droppings laying around after a merge.</em></strike> </p>  <p></p>  <p><strong><font size="3">Pushing Changes to the Central SVN Repo</font></strong></p>  <p>Now that we've made our changes, added them to the index, committed them locally and rebased, we can push those changes to the central SVN repo. Just to clarify, you can do multiple commits locally before you push your changes, so you don't have to push right after every commit if you don't want to (That's the beauty of a DVCS). To do this simply run the <font color="#0000ff" face="Courier New">git svn dcommit</font> command: </p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/blog/images/a9b2e404b7374bc9a949a361b451340e.png" width="597" height="311" /> </p>  <p>We can see that the commits that we made have been pushed to the upstream repo as separate svn revisions.</p>  <p><strong><font size="3">Conclusion</font></strong></p>  <p>You can easily get the benefits of Git even if you have to work with an svn repo. Yay! </p>  