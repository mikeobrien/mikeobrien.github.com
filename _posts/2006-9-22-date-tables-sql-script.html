--
layout: post
title: Date tables SQL script
categories: [TSQL/SQL Server]
tags: [TSQL/SQL Server]
--
<P>I have found it very useful to have date tables to perform date range queries. For example if you want to show total sales per month over the last 12 months. You can base your range off of the months over the last 12 months from your month date table. Doing a left join will allow you to return a record for each month even if there are no invoices for that month. </P>
<P>Date tables also give you an easy way of determining related values such as the next month begin date without having to calculate them on the fly. When you are dealing with many records, those dynamic calculations can have a definite performance impact.</P>
<P>The following SQL script creates a date table for the days, months and years between the start date and end date specified at the beginning of the script.</P>
<P><A href="https://docs.google.com/uc?id=0Bynmohn6qHD_Y2NjNzcyOTUtMGVjYi00YThlLWIxOGQtMzkzYzNiY2VmZDQ5">BuildDateTables.zip (.7 KB)</A></P>
<P>So in the previous example we could compile the sales summary as follows:<BR><FONT color=#0000ff size=2></P>
<P><FONT face="Courier New">SELECT</FONT></FONT><FONT face="Courier New"><FONT color=#000000 size=2> M</FONT><FONT color=#808080 size=2>.</FONT><FONT color=#000000 size=2>[Month]</FONT><FONT color=#808080 size=2>,</FONT><FONT color=#000000 size=2> </FONT><FONT color=#ff00ff size=2>ISNULL</FONT><FONT color=#808080 size=2>(</FONT><FONT color=#ff00ff size=2>SUM</FONT><FONT color=#808080 size=2>(</FONT><FONT color=#000000 size=2>INV</FONT><FONT color=#808080 size=2>.</FONT><FONT color=#000000 size=2>Amount</FONT><FONT color=#808080 size=2>),</FONT><FONT color=#000000 size=2>0</FONT><FONT color=#808080 size=2>)</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>AS</FONT></FONT><FONT face="Courier New"><FONT size=2><FONT color=#000000> TotalSales</FONT><BR></FONT><FONT color=#0000ff size=2>FROM</FONT><FONT color=#000000 size=2> Months </FONT><FONT color=#0000ff size=2>AS</FONT><FONT color=#000000 size=2> M </FONT><FONT color=#808080 size=2>LEFT</FONT><FONT color=#000000 size=2> </FONT><FONT color=#808080 size=2>OUTER</FONT><FONT color=#000000 size=2> </FONT><FONT color=#808080 size=2>JOIN</FONT><FONT color=#000000 size=2> Invoice </FONT><FONT color=#0000ff size=2>AS</FONT><FONT color=#000000 size=2> INV </FONT><FONT color=#0000ff size=2>ON</FONT><FONT color=#000000 size=2> INV</FONT><FONT color=#808080 size=2>.</FONT><FONT color=#000000 size=2>Date </FONT><FONT color=#808080 size=2>BETWEEN</FONT><FONT color=#000000 size=2> M</FONT><FONT color=#808080 size=2>.</FONT><FONT color=#000000 size=2>[Month] </FONT><FONT color=#808080 size=2>AND</FONT><FONT color=#000000 size=2> M</FONT><FONT color=#808080 size=2>.</FONT></FONT><FONT face="Courier New"><FONT size=2><FONT color=#000000>NextMonthBegin</FONT><BR></FONT><FONT color=#0000ff size=2>WHERE</FONT><FONT color=#000000 size=2> M</FONT><FONT color=#808080 size=2>.</FONT><FONT color=#000000 size=2>[Month] </FONT><FONT color=#808080 size=2>BETWEEN</FONT><FONT color=#000000 size=2> </FONT><FONT color=#ff00ff size=2>DATEADD</FONT><FONT color=#808080 size=2>(</FONT><FONT color=#ff00ff size=2>month</FONT><FONT color=#808080 size=2>,</FONT><FONT color=#000000 size=2> </FONT><FONT color=#808080 size=2>-</FONT><FONT color=#000000 size=2>12</FONT><FONT color=#808080 size=2>,</FONT><FONT color=#000000 size=2> </FONT><FONT color=#ff00ff size=2>GETDATE</FONT><FONT color=#808080 size=2>())</FONT><FONT color=#000000 size=2> </FONT><FONT color=#808080 size=2>AND</FONT><FONT color=#000000 size=2> </FONT><FONT color=#ff00ff size=2>GETDATE</FONT></FONT><FONT face="Courier New"><FONT color=#808080 size=2>()<BR></FONT><FONT color=#0000ff size=2>GROUP</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>BY</FONT><FONT color=#000000 size=2> M</FONT><FONT color=#808080 size=2>.</FONT></FONT><FONT face="Courier New"><FONT size=2><FONT color=#000000>[Month]</FONT><BR></FONT><FONT color=#0000ff size=2>ORDER</FONT><FONT color=#000000 size=2> </FONT><FONT color=#0000ff size=2>BY</FONT><FONT color=#000000 size=2> M</FONT><FONT color=#808080 size=2>.</FONT><FONT color=#000000 size=2>[Month] </FONT></FONT><FONT color=#0000ff size=2><FONT face="Courier New">DESC</FONT> 
<P></P></FONT>